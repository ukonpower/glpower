{"version":3,"file":"glpower.cjs","sources":["../src/VAO.ts","../src/Program.ts","../src/Buffer.ts","../src/Texture.ts","../src/Core.ts","../src/Math/Vector2.ts","../src/Math/Vector3.ts","../src/Math/Matrix4.ts","../src/Geometries/Geometry.ts","../src/Geometries/CubeGeometry.ts","../src/Geometries/CylinderGeometry.ts","../src/Geometries/PlaneGeometry.ts","../src/Geometries/SphereGeometry.ts","../src/ECS/index.ts","../src/ECS/System/index.ts","../src/SceneGraph/index.ts"],"sourcesContent":["import { Buffer } from \"./Buffer\";\r\n\r\nexport type Attribute = {\r\n\tarray: number[];\r\n\tsize: number;\r\n}\r\n\r\nexport type AttributeBuffer = {\r\n\tbuffer: Buffer;\r\n\tsize: number;\r\n\tcount: number;\r\n}\r\n\r\nexport type AttributeBufferWithLocation = {\r\n\tlocation: number | null;\r\n} & AttributeBuffer\r\n\r\nexport class VAO {\r\n\r\n\tprivate gl: WebGL2RenderingContext;\r\n\r\n\tpublic vao: WebGLVertexArrayObject | null = null;\r\n\r\n\tpublic program: WebGLProgram;\r\n\r\n\tprotected indexBuffer: Buffer | null = null;\r\n\r\n\tprotected attributes: {[key: string]: AttributeBufferWithLocation} = {};\r\n\r\n\tpublic vertCount: number = 0;\r\n\r\n\tconstructor( gl: WebGL2RenderingContext, program: WebGLProgram ) {\r\n\r\n\t\tthis.gl = gl;\r\n\r\n\t\tthis.program = program;\r\n\r\n\t\tthis.vao = this.gl.createVertexArray();\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tAttribute\r\n\t-------------------------------*/\r\n\r\n\tpublic setAttribute( name: string, buffer: Buffer, size: number, count: number ) {\r\n\r\n\t\tlet attr = this.attributes[ name ];\r\n\r\n\t\tif ( ! attr ) {\r\n\r\n\t\t\tattr = {\r\n\t\t\t\tbuffer,\r\n\t\t\t\tlocation: null,\r\n\t\t\t\tsize,\r\n\t\t\t\tcount\r\n\t\t\t};\r\n\r\n\t\t\tthis.attributes[ name ] = attr;\r\n\r\n\t\t}\r\n\r\n\t\tthis.updateAttributes();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic removeAttribute( name: string ) {\r\n\r\n\t\tdelete this.attributes[ name ];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic updateAttributes( force?: boolean ) {\r\n\r\n\t\tif ( ! this.vao ) return;\r\n\r\n\t\tthis.vertCount = 0;\r\n\r\n\t\tconst attrNameList = Object.keys( this.attributes );\r\n\r\n\t\tthis.gl.bindVertexArray( this.vao );\r\n\r\n\t\tfor ( let i = 0; i < attrNameList.length; i ++ ) {\r\n\r\n\t\t\tconst name = attrNameList[ i ];\r\n\t\t\tconst attribute = this.attributes[ name ];\r\n\r\n\t\t\tif ( ( attribute.location === null || force ) ) {\r\n\r\n\t\t\t\tattribute.location = this.gl.getAttribLocation( this.program, name );\r\n\r\n\t\t\t\tif ( attribute.location > - 1 ) {\r\n\r\n\t\t\t\t\tthis.gl.bindBuffer( this.gl.ARRAY_BUFFER, attribute.buffer.buffer );\r\n\t\t\t\t\tthis.gl.enableVertexAttribArray( attribute.location );\r\n\t\t\t\t\tthis.gl.vertexAttribPointer( attribute.location, attribute.size, this.gl.FLOAT, false, 0, 0 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.vertCount = Math.max( this.vertCount, attribute.count );\r\n\r\n\t\t}\r\n\r\n\t\tthis.gl.bindVertexArray( null );\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tIndex\r\n\t-------------------------------*/\r\n\r\n\tpublic setIndex( indexBuffer: Buffer | null ) {\r\n\r\n\t\tthis.indexBuffer = indexBuffer;\r\n\r\n\t\tif ( ! this.vao ) return;\r\n\r\n\t\tthis.gl.bindVertexArray( this.vao );\r\n\r\n\t\tthis.gl.bindBuffer( this.gl.ELEMENT_ARRAY_BUFFER, this.indexBuffer ? this.indexBuffer.buffer : null );\r\n\r\n\t\tthis.gl.bindVertexArray( null );\r\n\r\n\r\n\t}\r\n\r\n\tpublic getVAO() {\r\n\r\n\t\treturn this.vao;\r\n\r\n\t}\r\n\r\n}\r\n","import { Matrix4 } from \"./Math/Matrix4\";\r\nimport { Vector2 } from \"./Math/Vector2\";\r\nimport { Vector3 } from \"./Math/Vector3\";\r\nimport { VAO } from \"./VAO\";\r\n\r\nexport type Uniformable = boolean | number | Vector2 | Vector3 | Matrix4;\r\nexport type UniformType =\r\n\t'1f' | '1fv' | '2f' | '2fv' | '3f' | '3fv' | '4f' | '4fv' |\r\n\t'1i' | '1iv' | '2i' | '2iv' | '3i' | '3iv' | '4i' | '4iv' |\r\n\t'Matrix2fv' | 'Matrix3fv' | 'Matrix4fv';\r\n\r\nexport type Uniform = {\r\n\tlocation: WebGLUniformLocation | null;\r\n\tvalue: ( number | boolean )[];\r\n\ttype: string;\r\n\tcache?: ( number | boolean )[];\r\n\tneedsUpdate?: boolean\r\n}\r\nexport class Program {\r\n\r\n\tpublic gl: WebGL2RenderingContext;\r\n\tpublic program: WebGLProgram | null;\r\n\r\n\tprivate vao: Map<string, VAO>;\r\n\tprotected uniforms: Map<string, Uniform>;\r\n\r\n\tconstructor( gl: WebGL2RenderingContext ) {\r\n\r\n\t\tthis.gl = gl;\r\n\r\n\t\tthis.program = this.gl.createProgram();\r\n\r\n\t\tthis.vao = new Map();\r\n\t\tthis.uniforms = new Map();\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tShader\r\n\t-------------------------------*/\r\n\r\n\tpublic setShader( vertexShaderSrc: string, fragmentShaderSrc: string ) {\r\n\r\n\t\tif ( this.program === null ) {\r\n\r\n\t\t\tconsole.warn( 'program is null.' );\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tconst vs = this.createShader( vertexShaderSrc, this.gl.VERTEX_SHADER );\r\n\t\tconst fs = this.createShader( fragmentShaderSrc, this.gl.FRAGMENT_SHADER );\r\n\r\n\t\tif ( ! vs || ! fs ) return;\r\n\r\n\t\tthis.gl.attachShader( this.program, vs );\r\n\t\tthis.gl.attachShader( this.program, fs );\r\n\r\n\t\tthis.gl.linkProgram( this.program );\r\n\r\n\t\tif ( ! this.gl.getProgramParameter( this.program, this.gl.LINK_STATUS ) ) {\r\n\r\n\t\t\tconsole.warn( 'program link error.' );\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tprotected createShader( shaderSrc: string, type: number ) {\r\n\r\n\t\tconst shader = this.gl.createShader( type );\r\n\r\n\t\tif ( ! shader ) {\r\n\r\n\t\t\treturn null;\r\n\r\n\t\t}\r\n\r\n\t\tthis.gl.shaderSource( shader, shaderSrc );\r\n\t\tthis.gl.compileShader( shader );\r\n\r\n\t\tif ( this.gl.getShaderParameter( shader, this.gl.COMPILE_STATUS ) ) {\r\n\r\n\t\t\treturn shader;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.error( this.gl.getShaderInfoLog( shader ) );\r\n\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tUniforms\r\n\t-------------------------------*/\r\n\r\n\tpublic setUniform( name: string, type: UniformType, value: ( number | boolean )[] ) {\r\n\r\n\t\tconst uniform = this.uniforms.get( name );\r\n\r\n\t\tif ( uniform ) {\r\n\r\n\t\t\tuniform.type = type;\r\n\t\t\tuniform.value = value;\r\n\r\n\t\t\tif ( uniform.cache ) {\r\n\r\n\t\t\t\tfor ( let i = 0; i < value.length; i ++ ) {\r\n\r\n\t\t\t\t\tif ( uniform.cache[ i ] !== value[ i ] ) {\r\n\r\n\t\t\t\t\t\tuniform.needsUpdate = true;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tuniform.needsUpdate = true;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.uniforms.set( name, {\r\n\t\t\t\tvalue,\r\n\t\t\t\ttype: type,\r\n\t\t\t\tlocation: null,\r\n\t\t\t\tneedsUpdate: true\r\n\t\t\t} );\r\n\r\n\t\t\tthis.updateUniformLocations();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprivate updateUniformLocations( force?: boolean ) {\r\n\r\n\t\tif ( ! this.program ) return;\r\n\r\n\t\tthis.uniforms.forEach( ( uniform, key ) => {\r\n\r\n\t\t\tif ( uniform.location === null || force ) {\r\n\r\n\t\t\t\tuniform.location = this.gl.getUniformLocation( this.program!, key );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tpublic uploadUniforms() {\r\n\r\n\t\tthis.uniforms.forEach( uniform => {\r\n\r\n\t\t\tif ( uniform.needsUpdate ) {\r\n\r\n\t\t\t\tif ( /Matrix[2|3|4]fv/.test( uniform.type ) ) {\r\n\r\n\t\t\t\t\t( this.gl as any )[ 'uniform' + uniform.type ]( uniform.location, false, uniform.value );\r\n\r\n\t\t\t\t} else if ( /[1|2|3|4][f|i]$/.test( uniform.type ) ) {\r\n\r\n\t\t\t\t\t( this.gl as any )[ 'uniform' + uniform.type ]( uniform.location, ...uniform.value );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t( this.gl as any )[ 'uniform' + uniform.type ]( uniform.location, uniform.value );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tuniform.cache = uniform.value.concat();\r\n\t\t\t\tuniform.needsUpdate = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tVAO\r\n\t-------------------------------*/\r\n\r\n\tpublic getVAO( id: string = '_' ) {\r\n\r\n\t\tif ( ! this.program ) return null;\r\n\r\n\t\tlet vao = this.vao.get( id );\r\n\r\n\t\tif ( vao ) return vao;\r\n\r\n\t\tvao = new VAO( this.gl, this.program );\r\n\r\n\t\tthis.vao.set( id, vao );\r\n\r\n\t\treturn vao;\r\n\r\n\t}\r\n\r\n\t/*-------------------------------\r\n\t\tDraw??\r\n\t-------------------------------*/\r\n\r\n\tpublic use() {\r\n\r\n\t\tif ( ! this.program ) return;\r\n\r\n\t\tthis.gl.useProgram( this.program );\r\n\r\n\t}\r\n\r\n\tpublic clean() {\r\n\r\n\t\tthis.gl.useProgram( null );\r\n\r\n\t}\r\n\r\n\tpublic getProgram() {\r\n\r\n\t\treturn this.program;\r\n\r\n\t}\r\n\r\n}\r\n","export type BufferType = 'vbo' | 'ibo';\r\nexport type TArrayBuffer = Uint8Array | Uint16Array | Uint32Array | Float32Array | Float64Array\r\n\r\nexport class Buffer {\r\n\r\n\tprivate gl: WebGL2RenderingContext;\r\n\tpublic buffer: WebGLBuffer | null;\r\n\r\n\tconstructor( gl: WebGL2RenderingContext ) {\r\n\r\n\t\tthis.gl = gl;\r\n\r\n\t\tthis.buffer = this.gl.createBuffer();\r\n\r\n\t}\r\n\r\n\tpublic setData( data: TArrayBuffer, type: BufferType = 'vbo', usage?: number ) {\r\n\r\n\t\tconst target = type == 'vbo' ? this.gl.ARRAY_BUFFER : this.gl.ELEMENT_ARRAY_BUFFER;\r\n\r\n\t\tthis.gl.bindBuffer( target, this.buffer );\r\n\r\n\t\tthis.gl.bufferData( target, data, usage || this.gl.STATIC_DRAW );\r\n\r\n\t\tthis.gl.bindBuffer( target, null );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n","export class Texture {\r\n\r\n\tprivate gl: WebGL2RenderingContext;\r\n\tprivate image: HTMLImageElement | null;\r\n\tprivate texture: WebGLTexture | null;\r\n\r\n\tconstructor( gl: WebGL2RenderingContext ) {\r\n\r\n\t\tthis.gl = gl;\r\n\t\tthis.image = null;\r\n\r\n\t\tthis.texture = this.gl.createTexture();\r\n\r\n\t}\r\n\r\n\tpublic load( src: string ) {\r\n\r\n\t\tconst img = new Image();\r\n\r\n\t\timg.onload = () => {\r\n\r\n\t\t\tthis.image = img;\r\n\r\n\t\t\tthis.gl.bindTexture( this.gl.TEXTURE_2D, this.texture );\r\n\t\t\tthis.gl.texImage2D( this.gl.TEXTURE_2D, 0, this.gl.RGBA, this.gl.RGBA, this.gl.UNSIGNED_BYTE, this.image );\r\n\t\t\tthis.gl.generateMipmap( this.gl.TEXTURE_2D );\r\n\r\n\t\t};\r\n\r\n\t\timg.src = src;\r\n\r\n\t}\r\n\r\n\tpublic active( unitId: number ) {\r\n\r\n\t\tthis.gl.activeTexture( ( this.gl as any )[ \"TEXTURE\" + unitId ] );\r\n\t\tthis.gl.bindTexture( this.gl.TEXTURE_2D, this.texture );\r\n\r\n\t}\r\n\r\n\tpublic getTexture() {\r\n\r\n\t\treturn this.texture;\r\n\r\n\t}\r\n\r\n}\r\n","import { Program } from \"./Program\";\r\nimport { Buffer } from \"./Buffer\";\r\nimport { VAO } from \"./VAO\";\r\nimport { Texture } from \"./Texture\";\r\n\r\nexport class Core {\r\n\r\n\tpublic gl: WebGL2RenderingContext;\r\n\r\n\tconstructor( gl: WebGL2RenderingContext ) {\r\n\r\n\t\tthis.gl = gl;\r\n\r\n\t\tthis.gl.pixelStorei( gl.UNPACK_FLIP_Y_WEBGL, true );\r\n\r\n\t}\r\n\r\n\tpublic createProgram() {\r\n\r\n\t\tconst program = new Program( this.gl );\r\n\r\n\t\treturn program;\r\n\r\n\t}\r\n\r\n\tpublic createBuffer() {\r\n\r\n\t\tconst vertexBuffer = new Buffer( this.gl );\r\n\r\n\t\treturn vertexBuffer;\r\n\r\n\t}\r\n\r\n\tpublic createTexture() {\r\n\r\n\t\tconst texture = new Texture( this.gl );\r\n\r\n\t\treturn texture;\r\n\r\n\t}\r\n\r\n}\r\n\r\n","import { Vector3 } from \"./Vector3\";\r\n\r\nexport class Vector2 {\r\n\r\n\tpublic x: number;\r\n\tpublic y: number;\r\n\r\n\tconstructor( x?: number, y?: number ) {\r\n\r\n\t\tthis.x = x || 0;\r\n\t\tthis.y = y || 0;\r\n\r\n\t}\r\n\r\n\tpublic get isVector2() {\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tpublic set( x: number, y: number ) {\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic add( a: Vector2 ): Vector2\r\n\r\n\tpublic add( a: number ): Vector2\r\n\r\n\tpublic add( a: any ): Vector2 {\r\n\r\n\t\tif ( ( a as Vector2 ).isVector2 ) {\r\n\r\n\t\t\tthis.x += a.x;\r\n\t\t\tthis.y += a.y;\r\n\r\n\t\t} else if ( typeof ( a ) == 'number' ) {\r\n\r\n\t\t\tthis.x += a;\r\n\t\t\tthis.y += a;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic sub( a: Vector2 ): Vector2\r\n\r\n\tpublic sub( a: number ): Vector2\r\n\r\n\tpublic sub( a: any ): Vector2 {\r\n\r\n\t\tif ( ( a as Vector2 ).isVector2 ) {\r\n\r\n\t\t\tthis.x -= a.x;\r\n\t\t\tthis.y -= a.y;\r\n\r\n\t\t} else if ( typeof ( a ) == 'number' ) {\r\n\r\n\t\t\tthis.x -= a;\r\n\t\t\tthis.y -= a;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic multiply( a: number | Vector2 ) {\r\n\r\n\t\tthis.x *= ( a as Vector2 ).x | ( a as number );\r\n\t\tthis.y *= ( a as Vector2 ).y | ( a as number );\r\n\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic divide( a: number | Vector2 ) {\r\n\r\n\t\tthis.x /= ( a as Vector2 ).x | ( a as number );\r\n\t\tthis.y /= ( a as Vector2 ).y | ( a as number );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic copy( a: Vector2 | Vector3 ) {\r\n\r\n\t\tthis.x = a.x;\r\n\t\tthis.y = a.y;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic clone() {\r\n\r\n\t\treturn new Vector2( this.x, this.y );\r\n\r\n\t}\r\n\r\n\tpublic get elm() {\r\n\r\n\t\treturn [ this.x, this.y ];\r\n\r\n\t}\r\n\r\n}\r\n","import { Vector2 } from \"./Vector2\";\r\n\r\n\r\nexport type Vec3 = {\r\n\tx: number,\r\n\ty: number,\r\n\tz: number\r\n}\r\n\r\nexport class Vector3 {\r\n\r\n\tpublic x: number;\r\n\tpublic y: number;\r\n\tpublic z: number;\r\n\r\n\tconstructor( x?: number, y?: number, z?: number ) {\r\n\r\n\t\tthis.x = x || 0;\r\n\t\tthis.y = y || 0;\r\n\t\tthis.z = z || 0;\r\n\r\n\t}\r\n\r\n\tpublic get isVector3() {\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tpublic set( x: number, y: number, z: number ) {\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.z = z;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic add( a: Vector3 ): Vector3\r\n\r\n\tpublic add( a: number ): Vector3\r\n\r\n\tpublic add( a: any ): Vector3 {\r\n\r\n\t\tif ( ( a as Vector3 ).isVector3 ) {\r\n\r\n\t\t\tthis.x += a.x;\r\n\t\t\tthis.y += a.y;\r\n\t\t\tthis.z += a.z;\r\n\r\n\t\t} else if ( typeof ( a ) == 'number' ) {\r\n\r\n\t\t\tthis.x += a;\r\n\t\t\tthis.y += a;\r\n\t\t\tthis.z += a;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic sub( a: Vector3 ): Vector3\r\n\r\n\tpublic sub( a: number ): Vector3\r\n\r\n\tpublic sub( a: any ) {\r\n\r\n\t\tif ( ( a as Vector3 ).isVector3 ) {\r\n\r\n\t\t\tthis.x -= a.x;\r\n\t\t\tthis.y -= a.y;\r\n\t\t\tthis.z -= a.z;\r\n\r\n\t\t} else if ( typeof ( a ) == 'number' ) {\r\n\r\n\t\t\tthis.x -= a;\r\n\t\t\tthis.y -= a;\r\n\t\t\tthis.z -= a;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic multiply( a: number ) {\r\n\r\n\t\tthis.x *= a;\r\n\t\tthis.y *= a;\r\n\t\tthis.z *= a;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic divide( a: number ) {\r\n\r\n\t\tthis.x /= a;\r\n\t\tthis.y /= a;\r\n\t\tthis.z /= a;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic length() {\r\n\r\n\t\treturn Math.sqrt( this.x * this.x + this.y * this.y + this.z * this.z );\r\n\r\n\t}\r\n\r\n\tpublic normalize() {\r\n\r\n\t\treturn this.divide( this.length() || 1 );\r\n\r\n\t}\r\n\r\n\tpublic cross( v: Vector3 ) {\r\n\r\n\t\tconst ax = this.x, ay = this.y, az = this.z;\r\n\t\tconst bx = v.x, by = v.y, bz = v.z;\r\n\r\n\t\tthis.x = ay * bz - az * by;\r\n\t\tthis.y = az * bx - ax * bz;\r\n\t\tthis.z = ax * by - ay * bx;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic dot( v: Vector3 ) {\r\n\r\n\t\treturn this.x * v.x + this.y * v.y + this.z * v.z;\r\n\r\n\t}\r\n\r\n\tpublic copy( a: Vector2 | Vector3 ) {\r\n\r\n\t\tthis.x = a.x;\r\n\t\tthis.y = a.y;\r\n\t\tthis.z = ( a as any ).z || 0;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic clone() {\r\n\r\n\t\treturn new Vector3( this.x, this.y, this.z );\r\n\r\n\t}\r\n\r\n\tpublic get elm() {\r\n\r\n\t\treturn [ this.x, this.y, this.z ];\r\n\r\n\t}\r\n\r\n}\r\n","import { Vec3, Vector3 } from \"./Vector3\";\r\n\r\nexport class Matrix4 {\r\n\r\n\tpublic elm: number[];\r\n\r\n\tconstructor( elm?: number [] ) {\r\n\r\n\t\tthis.elm = [\r\n\t\t\t1, 0, 0, 0,\r\n\t\t\t0, 1, 0, 0,\r\n\t\t\t0, 0, 1, 0,\r\n\t\t\t0, 0, 0, 1,\r\n\t\t];\r\n\r\n\t\tif ( elm ) {\r\n\r\n\t\t\tthis.set( elm );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic get isMat4() {\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\tpublic identity() {\r\n\r\n\t\tthis.elm = [\r\n\t\t\t1, 0, 0, 0,\r\n\t\t\t0, 1, 0, 0,\r\n\t\t\t0, 0, 1, 0,\r\n\t\t\t0, 0, 0, 1,\r\n\t\t];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic clone() {\r\n\r\n\t\treturn new Matrix4().copy( this );\r\n\r\n\t}\r\n\r\n\tpublic copy( mat: Matrix4 ) {\r\n\r\n\t\tthis.set( mat.elm );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic perspective( fov: number, aspect: number, near: number, far: number ) {\r\n\r\n\t\tvar r = 1 / Math.tan( fov * Math.PI / 360 );\r\n\t\tvar d = far - near;\r\n\r\n\t\tthis.elm = [\r\n\t\t\tr / aspect, 0, 0, 0,\r\n\t\t\t0, r, 0, 0,\r\n\t\t\t0, 0, - ( far + near ) / d, - 1,\r\n\t\t\t0, 0, - ( far * near * 2 ) / d, 0\r\n\t\t];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic lookAt( eye: Vector3, target: Vector3, up: Vector3 ) {\r\n\r\n\t\tconst zAxis = eye.clone().sub( target ).normalize();\r\n\t\tconst xAxis = up.clone().cross( zAxis ).normalize();\r\n\t\tconst yAxis = zAxis.clone().cross( xAxis ).normalize();\r\n\r\n\t\tthis.elm = [\r\n\t\t   xAxis.x, yAxis.x, zAxis.x, 0,\r\n\t\t   xAxis.y, yAxis.y, zAxis.y, 0,\r\n\t\t   xAxis.z, yAxis.z, zAxis.z, 0,\r\n\t\t   - eye.dot( xAxis ),\r\n\t\t   - eye.dot( yAxis ),\r\n\t\t   - eye.dot( zAxis ),\r\n\t\t   1,\r\n\t\t];\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic inverse() {\r\n\r\n\t\tconst a = this.elm[ 0 ], b = this.elm[ 1 ], c = this.elm[ 2 ], d = this.elm[ 3 ],\r\n\t\t\te = this.elm[ 4 ], f = this.elm[ 5 ], g = this.elm[ 6 ], h = this.elm[ 7 ],\r\n\t\t\ti = this.elm[ 8 ], j = this.elm[ 9 ], k = this.elm[ 10 ], l = this.elm[ 11 ],\r\n\t\t\tm = this.elm[ 12 ], n = this.elm[ 13 ], o = this.elm[ 14 ], p = this.elm[ 15 ],\r\n\t\t\tq = a * f - b * e, r = a * g - c * e,\r\n\t\t\ts = a * h - d * e, t = b * g - c * f,\r\n\t\t\tu = b * h - d * f, v = c * h - d * g,\r\n\t\t\tw = i * n - j * m, x = i * o - k * m,\r\n\t\t\ty = i * p - l * m, z = j * o - k * n,\r\n\t\t\tA = j * p - l * n, B = k * p - l * o,\r\n\t\t\tdet = ( q * B - r * A + s * z + t * y - u * x + v * w ),\r\n\t\t\tivd = 1 / det;\r\n\r\n\t\tif ( det == 0 ) return this.identity();\r\n\r\n\t\tthis.elm[ 0 ] = ( f * B - g * A + h * z ) * ivd;\r\n\t\tthis.elm[ 1 ] = ( - b * B + c * A - d * z ) * ivd;\r\n\t\tthis.elm[ 2 ] = ( n * v - o * u + p * t ) * ivd;\r\n\t\tthis.elm[ 3 ] = ( - j * v + k * u - l * t ) * ivd;\r\n\t\tthis.elm[ 4 ] = ( - e * B + g * y - h * x ) * ivd;\r\n\t\tthis.elm[ 5 ] = ( a * B - c * y + d * x ) * ivd;\r\n\t\tthis.elm[ 6 ] = ( - m * v + o * s - p * r ) * ivd;\r\n\t\tthis.elm[ 7 ] = ( i * v - k * s + l * r ) * ivd;\r\n\t\tthis.elm[ 8 ] = ( e * A - f * y + h * w ) * ivd;\r\n\t\tthis.elm[ 9 ] = ( - a * A + b * y - d * w ) * ivd;\r\n\t\tthis.elm[ 10 ] = ( m * u - n * s + p * q ) * ivd;\r\n\t\tthis.elm[ 11 ] = ( - i * u + j * s - l * q ) * ivd;\r\n\t\tthis.elm[ 12 ] = ( - e * z + f * x - g * w ) * ivd;\r\n\t\tthis.elm[ 13 ] = ( a * z - b * x + c * w ) * ivd;\r\n\t\tthis.elm[ 14 ] = ( - m * t + n * r - o * q ) * ivd;\r\n\t\tthis.elm[ 15 ] = ( i * t - j * r + k * q ) * ivd;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic set( elm: number[] ) {\r\n\r\n\t\tfor ( let i = 0; i < this.elm.length; i ++ ) {\r\n\r\n\t\t\tthis.elm[ i ] = elm[ i ] ?? 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic setFromTransform( pos: Vec3, rot: Vec3, scale: Vec3 ) {\r\n\r\n\t\tthis.identity();\r\n\r\n\t\tthis.applyPosition( pos );\r\n\r\n\t\tthis.applyRot( rot );\r\n\r\n\t\tthis.applyScale( scale );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic decompose( pos?: Vec3, rot?: Vec3, scale?: Vec3 ) {\r\n\r\n\t\tif ( pos ) {\r\n\r\n\t\t\tpos.x = this.elm[ 12 ];\r\n\t\t\tpos.y = this.elm[ 13 ];\r\n\t\t\tpos.z = this.elm[ 14 ];\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic applyPosition( position: Vec3 ) {\r\n\r\n\t\tthis.matmul( [\r\n\t\t\t1, 0, 0, 0,\r\n\t\t\t0, 1, 0, 0,\r\n\t\t\t0, 0, 1, 0,\r\n\t\t\tposition.x, position.y, position.z, 1\r\n\t\t] );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic applyRot( rotation: Vec3 ) {\r\n\r\n\t\tlet c = Math.cos( rotation.x ), s = Math.sin( rotation.x );\r\n\r\n\t\tthis.matmul( [\r\n\t\t\t1, 0, 0, 0,\r\n\t\t\t0, c, s, 0,\r\n\t\t\t0, - s, c, 0,\r\n\t\t\t0, 0, 0, 1\r\n\t\t] );\r\n\r\n\t\tc = Math.cos( rotation.y ), s = Math.sin( rotation.y );\r\n\r\n\t\tthis.matmul( [\r\n\t\t\tc, 0, - s, 0,\r\n\t\t\t0, 1, 0, 0,\r\n\t\t    s, 0, c, 0,\r\n\t\t\t0, 0, 0, 1\r\n\t\t] );\r\n\r\n\t\tc = Math.cos( rotation.z ), s = Math.sin( rotation.z );\r\n\r\n\t\tthis.matmul( [\r\n\t\t\tc, s, 0, 0,\r\n\t\t\t- s, c, 0, 0,\r\n\t\t\t0, 0, 1, 0,\r\n\t\t\t0, 0, 0, 1\r\n\t\t] );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic applyScale( scale: Vec3 ) {\r\n\r\n\t\tthis.matmul( [\r\n\t\t\tscale.x, 0, 0, 0,\r\n\t\t\t0, scale.y, 0, 0,\r\n\t\t\t0, 0, scale.z, 0,\r\n\t\t\t0, 0, 0, 1\r\n\t\t] );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tprotected matmul( elm2: number[] ) {\r\n\r\n\t\tconst dist = new Array( 16 );\r\n\r\n\t\tfor ( let i = 0; i < 4; i ++ ) {\r\n\r\n\t\t\tfor ( let j = 0; j < 4; j ++ ) {\r\n\r\n\t\t\t\tlet sum = 0;\r\n\r\n\t\t\t\tfor ( let k = 0; k < 4; k ++ ) {\r\n\r\n\t\t\t\t\tsum += this.elm[ k * 4 + j ] * elm2[ k + i * 4 ];\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdist[ j + i * 4 ] = sum;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.elm = dist;\r\n\r\n\t}\r\n\r\n\tpublic multiply( m: Matrix4 ) {\r\n\r\n\t\tthis.matmul( m.elm );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic preMultiply( m: Matrix4 ) {\r\n\r\n\t\tconst tmp = this.copyToArray( [] );\r\n\r\n\t\tthis.set( m.elm );\r\n\r\n\t\tthis.matmul( tmp );\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tpublic copyToArray( array: number[] ) {\r\n\r\n\t\tarray.length = this.elm.length;\r\n\r\n\t\tfor ( let i = 0; i < this.elm.length; i ++ ) {\r\n\r\n\t\t\tarray[ i ] = this.elm[ i ];\r\n\r\n\t\t}\r\n\r\n\t\treturn array;\r\n\r\n\t}\r\n\r\n\r\n}\r\n","import { BufferType } from \"../Buffer\";\r\nimport { Core } from \"../Core\";\r\nimport { Attribute, AttributeBuffer } from \"../VAO\";\r\n\r\ntype DefaultAttributeName = 'position' | 'uv' | 'normal' | 'index';\r\n\r\nexport class Geometry {\r\n\r\n\tpublic count: number = 0;\r\n\r\n\tpublic attributes: {[key: string]: Attribute} = {};\r\n\r\n\tconstructor() {\r\n\t}\r\n\r\n\tpublic setAttribute( name: DefaultAttributeName | ( string & {} ), array: number[], size: number ) {\r\n\r\n\t\tthis.attributes[ name ] = {\r\n\t\t\tarray,\r\n\t\t\tsize\r\n\t\t};\r\n\r\n\t\tthis.updateVertCount();\r\n\r\n\t}\r\n\r\n\tpublic getAttribute( name: DefaultAttributeName | ( string & {} ) ) {\r\n\r\n\t\treturn this.attributes[ name ];\r\n\r\n\t}\r\n\r\n\tprivate updateVertCount() {\r\n\r\n\t\tconst keys = Object.keys( this.attributes );\r\n\r\n\t\tthis.count = keys.length > 0 ? Infinity : 0;\r\n\r\n\t\tkeys.forEach( name => {\r\n\r\n\t\t\tconst attribute = this.attributes[ name ];\r\n\r\n\t\t\tif ( name != 'index' ) {\r\n\r\n\t\t\t\tthis.count = Math.min( attribute.array.length / attribute.size, this.count );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t// ecs\r\n\r\n\tpublic getAttributeBuffer( core: Core, name: DefaultAttributeName | ( string & {} ), constructor: Float32ArrayConstructor | Uint16ArrayConstructor, bufferType: BufferType = 'vbo' ): AttributeBuffer {\r\n\r\n\t\tconst attr = this.getAttribute( name );\r\n\r\n\t\treturn {\r\n\t\t\tbuffer: core.createBuffer().setData( new constructor( attr.array ), bufferType ),\r\n\t\t\tsize: attr.size,\r\n\t\t\tcount: attr.array.length / attr.size\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tpublic getComponent( core: Core ) {\r\n\r\n\t\treturn {\r\n\t\t\tattributes: [\r\n\t\t\t\t{ name: 'position', ...this.getAttributeBuffer( core, 'position', Float32Array ) },\r\n\t\t\t\t{ name: 'uv', ...this.getAttributeBuffer( core, 'uv', Float32Array ) },\r\n\t\t\t\t{ name: 'normal', ...this.getAttributeBuffer( core, 'normal', Float32Array ) },\r\n\t\t\t],\r\n\t\t\tindex: this.getAttributeBuffer( core, 'index', Uint16Array, 'ibo' )\r\n\t\t};\r\n\r\n\t}\r\n\r\n}\r\n","import { Geometry } from './Geometry';\r\n\r\nexport class CubeGeometry extends Geometry {\r\n\r\n\tconstructor( width: number = 1, height: number = 1, depth: number = 1 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tconst hx = width / 2;\r\n\t\tconst hy = height / 2;\r\n\t\tconst hz = depth / 2;\r\n\r\n\t\tconst posArray = [\r\n\t\t\t- hx, hy, hz,\r\n\t\t\thx, hy, hz,\r\n\t\t\t- hx, - hy, hz,\r\n\t\t\thx, - hy, hz,\r\n\r\n\t\t\thx, hy, - hz,\r\n\t\t\t- hx, hy, - hz,\r\n\t\t\thx, - hy, - hz,\r\n\t\t\t- hx, - hy, - hz,\r\n\r\n\t\t\thx, hy, hz,\r\n\t\t\thx, hy, - hz,\r\n\t\t\thx, - hy, hz,\r\n\t\t\thx, - hy, - hz,\r\n\r\n\t\t\t- hx, hy, - hz,\r\n\t\t\t- hx, hy, hz,\r\n\t\t\t- hx, - hy, - hz,\r\n\t\t\t- hx, - hy, hz,\r\n\r\n\t\t\thx, hy, - hz,\r\n\t\t\thx, hy, hz,\r\n\t\t\t- hx, hy, - hz,\r\n\t\t\t- hx, hy, hz,\r\n\r\n\t\t\t- hx, - hy, - hz,\r\n\t\t\t- hx, - hy, hz,\r\n\t\t\thx, - hy, - hz,\r\n\t\t\thx, - hy, hz,\r\n\r\n\t\t];\r\n\r\n\t\tconst normalArray = [\r\n\t\t\t0, 0, 1,\r\n\t\t\t0, 0, 1,\r\n\t\t\t0, 0, 1,\r\n\t\t\t0, 0, 1,\r\n\t\t\t0, 0, - 1,\r\n\t\t\t0, 0, - 1,\r\n\t\t\t0, 0, - 1,\r\n\t\t\t0, 0, - 1,\r\n\t\t\t1, 0, 0,\r\n\t\t\t1, 0, 0,\r\n\t\t\t1, 0, 0,\r\n\t\t\t1, 0, 0,\r\n\t\t\t- 1, 0, 0,\r\n\t\t\t- 1, 0, 0,\r\n\t\t\t- 1, 0, 0,\r\n\t\t\t- 1, 0, 0,\r\n\t\t\t0, 1, 0,\r\n\t\t\t0, 1, 0,\r\n\t\t\t0, 1, 0,\r\n\t\t\t0, 1, 0,\r\n\t\t\t0, - 1, 0,\r\n\t\t\t0, - 1, 0,\r\n\t\t\t0, - 1, 0,\r\n\t\t\t0, - 1, 0,\r\n\t\t];\r\n\r\n\t\tconst uvArray = [];\r\n\t\tconst indexArray = [];\r\n\r\n\t\tfor ( let i = 0; i < 6; i ++ ) {\r\n\r\n\t\t\tuvArray.push(\r\n\t\t\t\t0, 1,\r\n\t\t\t\t1, 1,\r\n\t\t\t\t0, 0,\r\n\t\t\t\t1, 0\r\n\t\t\t);\r\n\r\n\t\t\tconst offset = 4 * i;\r\n\r\n\t\t\tindexArray.push(\r\n\t\t\t\t0 + offset, 2 + offset, 1 + offset, 1 + offset, 2 + offset, 3 + offset\r\n\t\t\t);\r\n\r\n\t\t}\r\n\r\n\t\tthis.setAttribute( 'position', posArray, 3 );\r\n\t\tthis.setAttribute( 'normal', normalArray, 3 );\r\n\t\tthis.setAttribute( 'uv', uvArray, 2 );\r\n\t\tthis.setAttribute( 'index', indexArray, 1 );\r\n\r\n\t}\r\n\r\n}\r\n","import { Geometry } from './Geometry';\r\nimport { Vector3 } from '../Math/Vector3';\r\n\r\nexport class CylinderGeometry extends Geometry {\r\n\r\n\tconstructor( radiusTop: number = 0.5, radiusBottom: number = 0.5, height: number = 1, radSegments: number = 10, heightSegments: number = 1 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tconst posArray = [];\r\n\t\tconst normalArray = [];\r\n\t\tconst uvArray = [];\r\n\t\tconst indexArray = [];\r\n\r\n\t\t//上下面分2回多くループ\r\n\t\tfor ( let i = 0; i <= heightSegments + 2; i ++ ) {\r\n\r\n\t\t\tfor ( let j = 0; j < radSegments; j ++ ) {\r\n\r\n\t\t\t\tconst theta = Math.PI * 2.0 / radSegments * j;\r\n\r\n\t\t\t\tif ( i <= heightSegments ) {\r\n\r\n\t\t\t\t\t//side\r\n\t\t\t\t\tconst w = i / heightSegments;\r\n\t\t\t\t\tconst radius = ( 1.0 - w ) * radiusBottom + w * radiusTop;\r\n\r\n\t\t\t\t\tconst x = Math.cos( theta ) * radius;\r\n\t\t\t\t\tconst y = - ( height / 2 ) + ( height / heightSegments ) * i;\r\n\t\t\t\t\tconst z = Math.sin( theta ) * radius;\r\n\r\n\t\t\t\t\tposArray.push( x, y, z );\r\n\r\n\t\t\t\t\tuvArray.push(\r\n\t\t\t\t\t\tj / radSegments,\r\n\t\t\t\t\t\ti / heightSegments\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tconst normal = new Vector3( Math.cos( theta ), 0, Math.sin( theta ) ).normalize();\r\n\r\n\t\t\t\t\tnormalArray.push(\r\n\t\t\t\t\t\tnormal.x,\r\n\t\t\t\t\t\tnormal.y,\r\n\t\t\t\t\t\tnormal.z\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tif ( i < heightSegments ) {\r\n\r\n\t\t\t\t\t\tindexArray.push(\r\n\t\t\t\t\t\t\ti * radSegments + j,\r\n\t\t\t\t\t\t\t( i + 1 ) * radSegments + ( j + 1 ) % radSegments,\r\n\t\t\t\t\t\t\ti * radSegments + ( j + 1 ) % radSegments,\r\n\r\n\t\t\t\t\t\t\ti * radSegments + j,\r\n\t\t\t\t\t\t\t( i + 1 ) * radSegments + j,\r\n\t\t\t\t\t\t\t( i + 1 ) * radSegments + ( j + 1 ) % radSegments,\r\n\r\n\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t//bottom, top\r\n\r\n\t\t\t\t\tconst side = i - heightSegments - 1;\r\n\r\n\t\t\t\t\tconst radius = side ? radiusTop : radiusBottom;\r\n\r\n\t\t\t\t\tconst x = Math.cos( theta ) * radius;\r\n\t\t\t\t\tconst y = - ( height / 2 ) + height * ( side );\r\n\t\t\t\t\tconst z = Math.sin( theta ) * radius;\r\n\r\n\t\t\t\t\tposArray.push( x, y, z );\r\n\r\n\t\t\t\t\tuvArray.push(\r\n\t\t\t\t\t\t( x + radius ) * 0.5 / radius,\r\n\t\t\t\t\t\t( z + radius ) * 0.5 / radius,\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tnormalArray.push( 0, - 1 + side * 2, 0 );\r\n\r\n\t\t\t\t\tconst offset = radSegments * ( heightSegments + ( side + 1 ) );\r\n\r\n\t\t\t\t\tif ( j <= radSegments - 2 ) {\r\n\r\n\t\t\t\t\t\tif ( side == 0 ) {\r\n\r\n\t\t\t\t\t\t\tindexArray.push(\r\n\t\t\t\t\t\t\t\toffset, offset + j, offset + j + 1,\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tindexArray.push(\r\n\t\t\t\t\t\t\t\toffset, offset + j + 1, offset + j\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// let offset = radSegments * heightSegments;\r\n\t\t// for( let i = 2; i < radSegments; i++ ){\r\n\r\n\t\t// \tindexArray.push(\r\n\t\t// \t\t0, i, i - 1,\r\n\t\t// \t\t0 + offset, i + offset, i - 1 + offset,\r\n\t\t// \t);\r\n\r\n\t\t// }\r\n\r\n\t\tthis.setAttribute( 'position', posArray, 3 );\r\n\t\tthis.setAttribute( 'normal', normalArray, 3 );\r\n\t\tthis.setAttribute( 'uv', uvArray, 2 );\r\n\t\tthis.setAttribute( 'index', indexArray, 1 );\r\n\r\n\t}\r\n\r\n}\r\n","import { Geometry } from './Geometry';\r\n\r\nexport class PlaneGeometry extends Geometry {\r\n\r\n\tconstructor( width: number = 1, height: number = 1, widthSegments: number = 1, heightSegments: number = 1 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tconst hx = width / 2;\r\n\t\tconst hy = height / 2;\r\n\r\n\t\tconst posArray = [];\r\n\t\tconst normalArray = [];\r\n\t\tconst uvArray = [];\r\n\t\tconst indexArray = [];\r\n\r\n\t\tfor ( let i = 0; i <= heightSegments; i ++ ) {\r\n\r\n\t\t\tfor ( let j = 0; j <= widthSegments; j ++ ) {\r\n\r\n\t\t\t\tconst x = ( j / widthSegments );\r\n\t\t\t\tconst y = ( i / widthSegments );\r\n\r\n\t\t\t\tposArray.push(\r\n\t\t\t\t\t- hx + width * x,\r\n\t\t\t\t\t- hy + height * y,\r\n\t\t\t\t\t0\r\n\t\t\t\t);\r\n\r\n\t\t\t\tuvArray.push( x, y );\r\n\r\n\t\t\t\tnormalArray.push( 0, 1, 0 );\r\n\r\n\t\t\t\tif ( i > 0 && j > 0 ) {\r\n\r\n\t\t\t\t\tconst n = ( widthSegments + 1 );\r\n\t\t\t\t\tconst ru = n * i + j;\r\n\t\t\t\t\tconst lb = n * ( i - 1 ) + j - 1;\r\n\r\n\t\t\t\t\tindexArray.push(\r\n\t\t\t\t\t\tru, n * i + j - 1, lb,\r\n\t\t\t\t\t\tru, lb, n * ( i - 1 ) + j,\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.setAttribute( 'position', posArray, 3 );\r\n\t\tthis.setAttribute( 'normal', normalArray, 3 );\r\n\t\tthis.setAttribute( 'uv', uvArray, 2 );\r\n\t\tthis.setAttribute( 'index', indexArray, 1 );\r\n\r\n\t}\r\n\r\n}\r\n","import { Geometry } from './Geometry';\r\nimport { Vector3 } from '../Math/Vector3';\r\n\r\nexport class SphereGeometry extends Geometry {\r\n\r\n\tconstructor( radius: number = 0.5, widthSegments: number = 20, heightSegments: number = 10 ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tconst posArray = [];\r\n\t\tconst normalArray = [];\r\n\t\tconst uvArray = [];\r\n\t\tconst indexArray = [];\r\n\r\n\t\tfor ( let i = 0; i <= heightSegments; i ++ ) {\r\n\r\n\t\t\tconst thetaI = i / heightSegments * Math.PI;\r\n\r\n\t\t\tconst segments = ( i != 0 && i != heightSegments ) ? widthSegments : widthSegments;\r\n\r\n\t\t\tfor ( let j = 0; j < segments; j ++ ) {\r\n\r\n\t\t\t\t// pos\r\n\r\n\t\t\t\tconst thetaJ = j / segments * Math.PI * 2.0;\r\n\t\t\t\tconst widthRadius = Math.sin( thetaI ) * radius;\r\n\r\n\t\t\t\tconst x = Math.cos( thetaJ ) * widthRadius;\r\n\t\t\t\tconst y = - Math.cos( thetaI ) * radius;\r\n\t\t\t\tconst z = Math.sin( thetaJ ) * widthRadius;\r\n\r\n\t\t\t\tposArray.push( x, y, z );\r\n\r\n\t\t\t\t// uv\r\n\r\n\t\t\t\tuvArray.push(\r\n\t\t\t\t\tj / segments,\r\n\t\t\t\t\ti / heightSegments\r\n\t\t\t\t);\r\n\r\n\t\t\t\t//normal\r\n\r\n\t\t\t\tconst normal = new Vector3( x, y, z ).normalize();\r\n\r\n\t\t\t\tnormalArray.push( normal.x, normal.y, normal.z );\r\n\r\n\t\t\t\t// index\r\n\r\n\t\t\t\tindexArray.push(\r\n\t\t\t\t\ti * widthSegments + j,\r\n\t\t\t\t\t( i + 1 ) * widthSegments + ( j + 1 ) % widthSegments,\r\n\t\t\t\t\ti * widthSegments + ( j + 1 ) % widthSegments,\r\n\r\n\t\t\t\t\ti * widthSegments + j,\r\n\t\t\t\t\t( i + 1 ) * widthSegments + j,\r\n\t\t\t\t\t( i + 1 ) * widthSegments + ( j + 1 ) % widthSegments,\r\n\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.setAttribute( 'position', posArray, 3 );\r\n\t\tthis.setAttribute( 'normal', normalArray, 3 );\r\n\t\tthis.setAttribute( 'uv', uvArray, 2 );\r\n\t\tthis.setAttribute( 'index', indexArray, 1 );\r\n\r\n\t}\r\n\r\n\tpublic setAttribute( name: ( 'position' | 'uv' | 'normal' | 'index' ) | ( string & {} ), array: number[], size: number ): void {\r\n\r\n\t\tif ( name == 'index' ) {\r\n\r\n\t\t\tarray.forEach( ( item, index ) => {\r\n\r\n\t\t\t\t// クソ\r\n\t\t\t\tarray[ index ] = item % this.count;\r\n\r\n\t\t\t} );\r\n\r\n\t\t}\r\n\r\n\t\tsuper.setAttribute( name, array, size );\r\n\r\n\r\n\r\n\t}\r\n\r\n}\r\n","import { Component, ComponentName } from \"./Component\";\r\nimport { Entity } from \"./Entity\";\r\nimport { EntityQuery, System } from \"./System\";\r\nimport { World } from \"./World\";\r\n\r\nexport interface ECSUpdateEvent {\r\n\tworld: World,\r\n\ttime: number,\r\n\tdeltaTime: number,\r\n}\r\n\r\nexport class ECS {\r\n\r\n\t// time\r\n\tprivate time: number;\r\n\tprivate lastUpdateTime: number;\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis.time = 0;\r\n\t\tthis.lastUpdateTime = new Date().getTime();\r\n\r\n\t}\r\n\r\n\tpublic createWorld(): World {\r\n\r\n\t\treturn {\r\n\t\t\tentitiesTotalCount: 0,\r\n\t\t\tentities: [],\r\n\t\t\tcomponents: new Map(),\r\n\t\t\tsystems: new Map()\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t// entity\r\n\r\n\tpublic createEntity( world: World ): Entity {\r\n\r\n\t\tconst entity: Entity = world.entitiesTotalCount ++;\r\n\r\n\t\tworld.entities.push( entity );\r\n\r\n\t\treturn entity;\r\n\r\n\t}\r\n\r\n\tpublic removeEntity( world: World, entity: Entity ): void {\r\n\r\n\t\tconst index = world.entities.findIndex( e => e == entity );\r\n\r\n\t\tif ( index > - 1 ) {\r\n\r\n\t\t\tworld.entities.slice( index, 1 );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// component\r\n\r\n\tpublic addComponent<T extends Component >( world: World, entity: Entity, componentName: ComponentName, component: T ) {\r\n\r\n\t\tlet componentArray = world.components.get( componentName );\r\n\r\n\t\tif ( componentArray === undefined ) {\r\n\r\n\t\t\tcomponentArray = [];\r\n\r\n\t\t\tworld.components.set( componentName, componentArray );\r\n\r\n\t\t}\r\n\r\n\t\tif ( componentArray.length < entity + 1 ) {\r\n\r\n\t\t\tcomponentArray.length = entity + 1;\r\n\r\n\t\t}\r\n\r\n\t\tcomponentArray[ entity ] = component;\r\n\r\n\t}\r\n\r\n\tpublic removeComponent( world: World, entity: Entity, componentName: ComponentName ) {\r\n\r\n\t\tconst componentArray = world.components.get( componentName );\r\n\r\n\t\tif ( componentArray && componentArray.length > entity ) {\r\n\r\n\t\t\tcomponentArray[ entity ] = null;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic getComponent<T extends Component >( world: World, entity: Entity, componentName: ComponentName ): T | null {\r\n\r\n\t\tconst component = world.components.get( componentName );\r\n\r\n\t\tif ( component !== undefined ) {\r\n\r\n\t\t\treturn ( component[ entity ] || null ) as T;\r\n\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\r\n\t}\r\n\r\n\t// system\r\n\r\n\tpublic addSystem<T extends System >( world: World, systemName: string, system: T ) {\r\n\r\n\t\tworld.systems.set( systemName, system );\r\n\r\n\t}\r\n\r\n\tpublic removeSystem( world: World, componentName: ComponentName ) {\r\n\r\n\t\tworld.systems.delete( componentName );\r\n\r\n\t}\r\n\r\n\t// update\r\n\r\n\tpublic update( world: World ) {\r\n\r\n\t\tconst now = new Date().getTime();\r\n\t\tconst deltaTime = ( now - this.lastUpdateTime ) / 1000;\r\n\t\tthis.time += deltaTime;\r\n\t\tthis.lastUpdateTime = now;\r\n\r\n\t\tconst systemList = world.systems;\r\n\r\n\t\tsystemList.forEach( system => {\r\n\r\n\t\t\tsystem.update( {\r\n\t\t\t\tworld,\r\n\t\t\t\tdeltaTime,\r\n\t\t\t\ttime: this.time,\r\n\t\t\t\tecs: this,\r\n\t\t\t} );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t// entities\r\n\r\n\tpublic getEntities( world: World, query: EntityQuery ): Entity[] {\r\n\r\n\t\tconst entities = world.entities.filter( entt => {\r\n\r\n\t\t\tfor ( let i = 0; i < query.length; i ++ ) {\r\n\r\n\t\t\t\tconst componentName = query[ i ];\r\n\r\n\t\t\t\tconst component = world.components.get( componentName );\r\n\r\n\t\t\t\tif ( component === undefined || component[ entt ] === undefined ) {\r\n\r\n\t\t\t\t\treturn false;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t} );\r\n\r\n\t\treturn entities;\r\n\r\n\t}\r\n\r\n}\r\n","import { ECS, ECSUpdateEvent } from \"..\";\r\nimport { ComponentName } from \"../Component\";\r\nimport { Entity } from \"../Entity\";\r\n\r\nexport type EntityQuery = ComponentName[]\r\n\r\nexport interface SystemUpdateEvent extends ECSUpdateEvent {\r\n\tecs: ECS\r\n}\r\n\r\nexport class System {\r\n\r\n\tprotected queries: {name: string, query: EntityQuery}[];\r\n\r\n\tconstructor( queries: {[key: string]:EntityQuery} ) {\r\n\r\n\t\tthis.queries = [];\r\n\r\n\t\tconst keys = Object.keys( queries );\r\n\r\n\t\tfor ( let i = 0; i < keys.length; i ++ ) {\r\n\r\n\t\t\tconst name = keys[ i ];\r\n\r\n\t\t\tthis.queries.push( { name, query: queries[ name ] } );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic update( event: SystemUpdateEvent ): void {\r\n\r\n\t\tfor ( let i = 0; i < this.queries.length; i ++ ) {\r\n\r\n\t\t\tconst q = this.queries[ i ];\r\n\r\n\t\t\tconst entities = event.ecs.getEntities( event.world, q.query );\r\n\r\n\t\t\tthis.beforeUpdateImpl( q.name, event );\r\n\r\n\t\t\tfor ( let j = 0; j < entities.length; j ++ ) {\r\n\r\n\t\t\t\tthis.updateImpl( q.name, entities[ j ], event );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.afterUpdateImpl( q.name, event );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprotected beforeUpdateImpl( logicName: string, event: SystemUpdateEvent ) { // eslint-disable-line\r\n\t}\r\n\r\n\tprotected updateImpl( logicName: string, entity: Entity, event: SystemUpdateEvent ) { // eslint-disable-line\r\n\t}\r\n\r\n\tprotected afterUpdateImpl( logicName: string, event: SystemUpdateEvent ) { // eslint-disable-line\r\n\t}\r\n\r\n}\r\n","import { ECS } from '../ECS';\r\nimport { ComponentSceneNode } from '../ECS/Component';\r\nimport { Entity } from '../ECS/Entity';\r\nimport { World } from '../ECS/World';\r\n\r\nexport class SceneGraph {\r\n\r\n\tprivate ecs: ECS;\r\n\tprivate world: World;\r\n\r\n\tprivate entities: Entity[];\r\n\r\n\tprivate cacheTransformUpdateOrder: Entity[] | null;\r\n\tprivate cacheRenderOrder: Entity[] | null;\r\n\r\n\tconstructor( ecs: ECS, world: World ) {\r\n\r\n\t\tthis.ecs = ecs;\r\n\t\tthis.world = world;\r\n\r\n\t\tthis.entities = [];\r\n\r\n\t\tthis.cacheTransformUpdateOrder = null;\r\n\t\tthis.cacheRenderOrder = null;\r\n\r\n\t}\r\n\r\n\tpublic add( parent: Entity, child: Entity ) {\r\n\r\n\t\tconst parentNode = this.ecs.getComponent<ComponentSceneNode>( this.world, parent, 'sceneNode' );\r\n\r\n\t\tif ( parentNode === null ) {\r\n\r\n\t\t\tconsole.log( 'parent not exists.' );\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tconst childNode = this.ecs.getComponent<ComponentSceneNode>( this.world, child, 'sceneNode' );\r\n\r\n\t\tif ( childNode === null ) {\r\n\r\n\t\t\tconsole.log( 'children not exists.' );\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( childNode.parent !== undefined ) {\r\n\r\n\t\t\tthis.remove( childNode.parent, child );\r\n\r\n\t\t}\r\n\r\n\t\tparentNode.children.push( child );\r\n\t\tchildNode.parent = parent;\r\n\r\n\t\tthis.entities = Array.from( new Set( [ parent, child, ...this.entities ] ) );\r\n\r\n\t\tthis.cacheTransformUpdateOrder = null;\r\n\r\n\t}\r\n\r\n\tpublic remove( parent: Entity, child: Entity ) {\r\n\r\n\t\tconst parentNode = this.ecs.getComponent<ComponentSceneNode>( this.world, parent, 'sceneNode' );\r\n\r\n\t\tif ( parentNode === null ) {\r\n\r\n\t\t\tconsole.log( 'parent not exists.' );\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tconst childNode = this.ecs.getComponent<ComponentSceneNode>( this.world, child, 'sceneNode' );\r\n\r\n\t\tif ( childNode === null ) {\r\n\r\n\t\t\tconsole.log( 'children not exists.' );\r\n\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\t// remove from parent\r\n\r\n\t\tlet i = parentNode.children.findIndex( entity => entity == child );\r\n\r\n\t\tif ( i > - 1 ) {\r\n\r\n\t\t\tparentNode.children.splice( i, 1 );\r\n\r\n\t\t}\r\n\r\n\t\tchildNode.parent = undefined;\r\n\r\n\t\t// remove from entity array\r\n\r\n\t\ti = this.entities.findIndex( entity => entity === child );\r\n\r\n\t\tif ( i > - 1 ) {\r\n\r\n\t\t\tthis.entities.splice( i, 1 );\r\n\r\n\t\t}\r\n\r\n\t\tthis.cacheTransformUpdateOrder = null;\r\n\r\n\t}\r\n\r\n\tpublic getTransformUpdateOrder() {\r\n\r\n\t\tif ( this.cacheTransformUpdateOrder ) return this.cacheTransformUpdateOrder;\r\n\r\n\t\tconst updateOrder: Entity[] = [];\r\n\r\n\t\tconst _ = ( entity: Entity ) => {\r\n\r\n\t\t\tupdateOrder.push( entity );\r\n\r\n\t\t\tconst sceneNode = this.ecs.getComponent<ComponentSceneNode>( this.world, entity, 'sceneNode' );\r\n\r\n\t\t\tif ( sceneNode ) {\r\n\r\n\t\t\t\tfor ( let i = 0; i < sceneNode.children.length; i ++ ) {\r\n\r\n\t\t\t\t\t_( sceneNode.children[ i ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t\tfor ( let i = 0; i < this.entities.length; i ++ ) {\r\n\r\n\t\t\tconst entity = this.entities[ i ];\r\n\r\n\t\t\tconst sceneNode = this.ecs.getComponent<ComponentSceneNode>( this.world, entity, 'sceneNode' );\r\n\r\n\t\t\tif ( sceneNode && sceneNode.parent === undefined ) {\r\n\r\n\t\t\t\t_( entity );\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t}\r\n\r\n\t\tthis.cacheTransformUpdateOrder = updateOrder;\r\n\r\n\t\treturn updateOrder;\r\n\r\n\t}\r\n\r\n\r\n}\r\n"],"names":["VAO","gl","program","name","buffer","size","count","attr","force","attrNameList","i","attribute","indexBuffer","Program","vertexShaderSrc","fragmentShaderSrc","vs","fs","shaderSrc","type","shader","value","uniform","key","id","vao","Buffer","data","usage","target","Texture","src","img","unitId","Core","Vector2","x","y","a","Vector3","z","v","ax","ay","az","bx","by","bz","Matrix4","elm","mat","fov","aspect","near","far","d","eye","up","zAxis","xAxis","yAxis","b","c","e","f","g","h","j","k","l","n","o","p","q","r","s","t","u","w","A","B","det","ivd","_a","pos","rot","scale","position","rotation","elm2","dist","sum","m","tmp","array","Geometry","keys","core","constructor","bufferType","CubeGeometry","width","height","depth","hx","hy","hz","posArray","normalArray","uvArray","indexArray","offset","CylinderGeometry","radiusTop","radiusBottom","radSegments","heightSegments","theta","radius","normal","side","PlaneGeometry","widthSegments","ru","lb","SphereGeometry","thetaI","segments","thetaJ","widthRadius","item","index","ECS","world","entity","componentName","component","componentArray","systemName","system","now","deltaTime","query","entt","System","queries","event","entities","logicName","SceneGraph","ecs","parent","child","parentNode","childNode","updateOrder","_","sceneNode"],"mappings":"4GAiBO,MAAMA,CAAI,CAchB,YAAaC,EAA4BC,EAAwB,CAVjE,KAAO,IAAqC,KAI5C,KAAU,YAA6B,KAEvC,KAAU,WAA2D,GAErE,KAAO,UAAoB,EAI1B,KAAK,GAAKD,EAEV,KAAK,QAAUC,EAEV,KAAA,IAAM,KAAK,GAAG,kBAAkB,CAEtC,CAMO,aAAcC,EAAcC,EAAgBC,EAAcC,EAAgB,CAE5E,IAAAC,EAAO,KAAK,WAAYJ,GAE5B,OAAOI,IAECA,EAAA,CACN,OAAAH,EACA,SAAU,KACV,KAAAC,EACA,MAAAC,CAAA,EAGD,KAAK,WAAYH,GAASI,GAI3B,KAAK,iBAAiB,EAEf,IAER,CAEO,gBAAiBJ,EAAe,CAEtC,cAAO,KAAK,WAAYA,GAEjB,IAER,CAEO,iBAAkBK,EAAkB,CAE1C,GAAK,CAAE,KAAK,IAAM,OAElB,KAAK,UAAY,EAEjB,MAAMC,EAAe,OAAO,KAAM,KAAK,UAAW,EAE7C,KAAA,GAAG,gBAAiB,KAAK,GAAI,EAElC,QAAUC,EAAI,EAAGA,EAAID,EAAa,OAAQC,IAAO,CAEhD,MAAMP,EAAOM,EAAcC,GACrBC,EAAY,KAAK,WAAYR,IAE5BQ,EAAU,WAAa,MAAQH,KAErCG,EAAU,SAAW,KAAK,GAAG,kBAAmB,KAAK,QAASR,CAAK,EAE9DQ,EAAU,SAAW,KAEzB,KAAK,GAAG,WAAY,KAAK,GAAG,aAAcA,EAAU,OAAO,MAAO,EAC7D,KAAA,GAAG,wBAAyBA,EAAU,QAAS,EAC/C,KAAA,GAAG,oBAAqBA,EAAU,SAAUA,EAAU,KAAM,KAAK,GAAG,MAAO,GAAO,EAAG,CAAE,IAM9F,KAAK,UAAY,KAAK,IAAK,KAAK,UAAWA,EAAU,KAAM,CAE5D,CAEK,KAAA,GAAG,gBAAiB,IAAK,CAE/B,CAMO,SAAUC,EAA6B,CAE7C,KAAK,YAAcA,EAEZ,KAAK,MAEP,KAAA,GAAG,gBAAiB,KAAK,GAAI,EAE7B,KAAA,GAAG,WAAY,KAAK,GAAG,qBAAsB,KAAK,YAAc,KAAK,YAAY,OAAS,IAAK,EAE/F,KAAA,GAAG,gBAAiB,IAAK,EAG/B,CAEO,QAAS,CAEf,OAAO,KAAK,GAEb,CAED,CCxHO,MAAMC,CAAQ,CAQpB,YAAaZ,EAA6B,CAEzC,KAAK,GAAKA,EAEL,KAAA,QAAU,KAAK,GAAG,cAAc,EAEhC,KAAA,QAAU,IACV,KAAA,aAAe,GAErB,CAMO,UAAWa,EAAyBC,EAA4B,CAEjE,GAAA,KAAK,UAAY,KAAO,CAE5B,QAAQ,KAAM,kBAAmB,EAEjC,MAED,CAEA,MAAMC,EAAK,KAAK,aAAcF,EAAiB,KAAK,GAAG,aAAc,EAC/DG,EAAK,KAAK,aAAcF,EAAmB,KAAK,GAAG,eAAgB,EAEpE,GAAA,GAAEC,GAAM,CAAEC,GAEf,YAAK,GAAG,aAAc,KAAK,QAASD,CAAG,EACvC,KAAK,GAAG,aAAc,KAAK,QAASC,CAAG,EAElC,KAAA,GAAG,YAAa,KAAK,OAAQ,EAE3B,KAAK,GAAG,oBAAqB,KAAK,QAAS,KAAK,GAAG,WAAY,GAErE,QAAQ,KAAM,qBAAsB,EAI9B,IAER,CAEU,aAAcC,EAAmBC,EAAe,CAEzD,MAAMC,EAAS,KAAK,GAAG,aAAcD,CAAK,EAE1C,OAAOC,GAMF,KAAA,GAAG,aAAcA,EAAQF,CAAU,EACnC,KAAA,GAAG,cAAeE,CAAO,EAEzB,KAAK,GAAG,mBAAoBA,EAAQ,KAAK,GAAG,cAAe,EAExDA,GAIP,QAAQ,MAAO,KAAK,GAAG,iBAAkBA,CAAO,CAAE,EAI5C,OAjBC,IAmBT,CAMO,WAAYjB,EAAcgB,EAAmBE,EAAgC,CAEnF,MAAMC,EAAU,KAAK,SAAS,IAAKnB,CAAK,EAExC,GAAKmB,EAKJ,GAHAA,EAAQ,KAAOH,EACfG,EAAQ,MAAQD,EAEXC,EAAQ,OAEZ,QAAUZ,EAAI,EAAGA,EAAIW,EAAM,OAAQX,IAElC,GAAKY,EAAQ,MAAOZ,KAAQW,EAAOX,GAAM,CAExCY,EAAQ,YAAc,GACtB,KAED,OAMDA,EAAQ,YAAc,QAMlB,KAAA,SAAS,IAAKnB,EAAM,CACxB,MAAAkB,EACA,KAAAF,EACA,SAAU,KACV,YAAa,EAAA,CACZ,EAEF,KAAK,uBAAuB,CAI9B,CAEQ,uBAAwBX,EAAkB,CAE5C,CAAE,KAAK,SAEZ,KAAK,SAAS,QAAS,CAAEc,EAASC,IAAS,EAErCD,EAAQ,WAAa,MAAQd,KAEjCc,EAAQ,SAAW,KAAK,GAAG,mBAAoB,KAAK,QAAUC,CAAI,EAEnE,CAEC,CAEH,CAEO,gBAAiB,CAElB,KAAA,SAAS,QAAoBD,GAAA,CAE5BA,EAAQ,cAEP,kBAAkB,KAAMA,EAAQ,IAAK,EAEvC,KAAK,GAAa,UAAYA,EAAQ,MAAQA,EAAQ,SAAU,GAAOA,EAAQ,KAAM,EAE5E,kBAAkB,KAAMA,EAAQ,IAAK,EAE9C,KAAK,GAAa,UAAYA,EAAQ,MAAQA,EAAQ,SAAU,GAAGA,EAAQ,KAAM,EAIjF,KAAK,GAAa,UAAYA,EAAQ,MAAQA,EAAQ,SAAUA,EAAQ,KAAM,EAIzEA,EAAA,MAAQA,EAAQ,MAAM,OAAO,EACrCA,EAAQ,YAAc,GAEvB,CAEC,CAEH,CAMO,OAAQE,EAAa,IAAM,CAEjC,GAAK,CAAE,KAAK,QAAiB,OAAA,KAE7B,IAAIC,EAAM,KAAK,IAAI,IAAKD,CAAG,EAEtB,OAAAC,IAELA,EAAM,IAAIzB,EAAK,KAAK,GAAI,KAAK,OAAQ,EAEhC,KAAA,IAAI,IAAKwB,EAAIC,CAAI,EAEfA,EAER,CAMO,KAAM,CAEP,CAAE,KAAK,SAEP,KAAA,GAAG,WAAY,KAAK,OAAQ,CAElC,CAEO,OAAQ,CAET,KAAA,GAAG,WAAY,IAAK,CAE1B,CAEO,YAAa,CAEnB,OAAO,KAAK,OAEb,CAED,CCvOO,MAAMC,CAAO,CAKnB,YAAazB,EAA6B,CAEzC,KAAK,GAAKA,EAEL,KAAA,OAAS,KAAK,GAAG,aAAa,CAEpC,CAEO,QAAS0B,EAAoBR,EAAmB,MAAOS,EAAiB,CAE9E,MAAMC,EAASV,GAAQ,MAAQ,KAAK,GAAG,aAAe,KAAK,GAAG,qBAE9D,YAAK,GAAG,WAAYU,EAAQ,KAAK,MAAO,EAExC,KAAK,GAAG,WAAYA,EAAQF,EAAMC,GAAS,KAAK,GAAG,WAAY,EAE1D,KAAA,GAAG,WAAYC,EAAQ,IAAK,EAE1B,IAER,CAED,CC9BO,MAAMC,CAAQ,CAMpB,YAAa7B,EAA6B,CAEzC,KAAK,GAAKA,EACV,KAAK,MAAQ,KAER,KAAA,QAAU,KAAK,GAAG,cAAc,CAEtC,CAEO,KAAM8B,EAAc,CAEpB,MAAAC,EAAM,IAAI,MAEhBA,EAAI,OAAS,IAAM,CAElB,KAAK,MAAQA,EAEb,KAAK,GAAG,YAAa,KAAK,GAAG,WAAY,KAAK,OAAQ,EACtD,KAAK,GAAG,WAAY,KAAK,GAAG,WAAY,EAAG,KAAK,GAAG,KAAM,KAAK,GAAG,KAAM,KAAK,GAAG,cAAe,KAAK,KAAM,EACzG,KAAK,GAAG,eAAgB,KAAK,GAAG,UAAW,CAAA,EAI5CA,EAAI,IAAMD,CAEX,CAEO,OAAQE,EAAiB,CAE/B,KAAK,GAAG,cAAiB,KAAK,GAAa,UAAYA,EAAS,EAChE,KAAK,GAAG,YAAa,KAAK,GAAG,WAAY,KAAK,OAAQ,CAEvD,CAEO,YAAa,CAEnB,OAAO,KAAK,OAEb,CAED,CCzCO,MAAMC,CAAK,CAIjB,YAAajC,EAA6B,CAEzC,KAAK,GAAKA,EAEV,KAAK,GAAG,YAAaA,EAAG,oBAAqB,EAAK,CAEnD,CAEO,eAAgB,CAIf,OAFS,IAAIY,EAAS,KAAK,EAAG,CAItC,CAEO,cAAe,CAId,OAFc,IAAIa,EAAQ,KAAK,EAAG,CAI1C,CAEO,eAAgB,CAIf,OAFS,IAAII,EAAS,KAAK,EAAG,CAItC,CAED,CCvCO,MAAMK,CAAQ,CAKpB,YAAaC,EAAYC,EAAa,CAErC,KAAK,EAAID,GAAK,EACd,KAAK,EAAIC,GAAK,CAEf,CAEA,IAAW,WAAY,CAEf,MAAA,EAER,CAEO,IAAKD,EAAWC,EAAY,CAElC,YAAK,EAAID,EACT,KAAK,EAAIC,EAEF,IAER,CAMO,IAAKC,EAAkB,CAE7B,OAAOA,EAAe,WAErB,KAAK,GAAKA,EAAE,EACZ,KAAK,GAAKA,EAAE,GAED,OAASA,GAAO,WAE3B,KAAK,GAAKA,EACV,KAAK,GAAKA,GAIJ,IAER,CAMO,IAAKA,EAAkB,CAE7B,OAAOA,EAAe,WAErB,KAAK,GAAKA,EAAE,EACZ,KAAK,GAAKA,EAAE,GAED,OAASA,GAAO,WAE3B,KAAK,GAAKA,EACV,KAAK,GAAKA,GAIJ,IAER,CAEO,SAAUA,EAAsB,CAEjC,YAAA,GAAOA,EAAe,EAAMA,EAC5B,KAAA,GAAOA,EAAe,EAAMA,EAG1B,IAER,CAEO,OAAQA,EAAsB,CAE/B,YAAA,GAAOA,EAAe,EAAMA,EAC5B,KAAA,GAAOA,EAAe,EAAMA,EAE1B,IAER,CAEO,KAAMA,EAAuB,CAEnC,YAAK,EAAIA,EAAE,EACX,KAAK,EAAIA,EAAE,EAEJ,IAER,CAEO,OAAQ,CAEd,OAAO,IAAIH,EAAS,KAAK,EAAG,KAAK,CAAE,CAEpC,CAEA,IAAW,KAAM,CAEhB,MAAO,CAAE,KAAK,EAAG,KAAK,CAAE,CAEzB,CAED,CCxGO,MAAMI,CAAQ,CAMpB,YAAaH,EAAYC,EAAYG,EAAa,CAEjD,KAAK,EAAIJ,GAAK,EACd,KAAK,EAAIC,GAAK,EACd,KAAK,EAAIG,GAAK,CAEf,CAEA,IAAW,WAAY,CAEf,MAAA,EAER,CAEO,IAAKJ,EAAWC,EAAWG,EAAY,CAE7C,YAAK,EAAIJ,EACT,KAAK,EAAIC,EACT,KAAK,EAAIG,EAEF,IAER,CAMO,IAAKF,EAAkB,CAE7B,OAAOA,EAAe,WAErB,KAAK,GAAKA,EAAE,EACZ,KAAK,GAAKA,EAAE,EACZ,KAAK,GAAKA,EAAE,GAED,OAASA,GAAO,WAE3B,KAAK,GAAKA,EACV,KAAK,GAAKA,EACV,KAAK,GAAKA,GAIJ,IAER,CAMO,IAAKA,EAAS,CAEpB,OAAOA,EAAe,WAErB,KAAK,GAAKA,EAAE,EACZ,KAAK,GAAKA,EAAE,EACZ,KAAK,GAAKA,EAAE,GAED,OAASA,GAAO,WAE3B,KAAK,GAAKA,EACV,KAAK,GAAKA,EACV,KAAK,GAAKA,GAIJ,IAER,CAEO,SAAUA,EAAY,CAE5B,YAAK,GAAKA,EACV,KAAK,GAAKA,EACV,KAAK,GAAKA,EAEH,IAER,CAEO,OAAQA,EAAY,CAE1B,YAAK,GAAKA,EACV,KAAK,GAAKA,EACV,KAAK,GAAKA,EAEH,IAER,CAEO,QAAS,CAEf,OAAO,KAAK,KAAM,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,EAAI,KAAK,CAAE,CAEvE,CAEO,WAAY,CAElB,OAAO,KAAK,OAAQ,KAAK,UAAY,CAAE,CAExC,CAEO,MAAOG,EAAa,CAE1B,MAAMC,EAAK,KAAK,EAAGC,EAAK,KAAK,EAAGC,EAAK,KAAK,EACpCC,EAAKJ,EAAE,EAAGK,EAAKL,EAAE,EAAGM,EAAKN,EAAE,EAE5B,YAAA,EAAIE,EAAKI,EAAKH,EAAKE,EACnB,KAAA,EAAIF,EAAKC,EAAKH,EAAKK,EACnB,KAAA,EAAIL,EAAKI,EAAKH,EAAKE,EAEjB,IAER,CAEO,IAAKJ,EAAa,CAEjB,OAAA,KAAK,EAAIA,EAAE,EAAI,KAAK,EAAIA,EAAE,EAAI,KAAK,EAAIA,EAAE,CAEjD,CAEO,KAAMH,EAAuB,CAEnC,YAAK,EAAIA,EAAE,EACX,KAAK,EAAIA,EAAE,EACN,KAAA,EAAMA,EAAW,GAAK,EAEpB,IAER,CAEO,OAAQ,CAEd,OAAO,IAAIC,EAAS,KAAK,EAAG,KAAK,EAAG,KAAK,CAAE,CAE5C,CAEA,IAAW,KAAM,CAEhB,MAAO,CAAE,KAAK,EAAG,KAAK,EAAG,KAAK,CAAE,CAEjC,CAED,CC9JO,MAAMS,CAAQ,CAIpB,YAAaC,EAAkB,CAE9B,KAAK,IAAM,CACV,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,CAAA,EAGLA,GAEJ,KAAK,IAAKA,CAAI,CAIhB,CAEA,IAAW,QAAS,CAEZ,MAAA,EAER,CAEO,UAAW,CAEjB,YAAK,IAAM,CACV,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,CAAA,EAGH,IAER,CAEO,OAAQ,CAEd,OAAO,IAAID,EAAA,EAAU,KAAM,IAAK,CAEjC,CAEO,KAAME,EAAe,CAEtB,YAAA,IAAKA,EAAI,GAAI,EAEX,IAER,CAEO,YAAaC,EAAaC,EAAgBC,EAAcC,EAAc,CAE5E,IAAI,EAAI,EAAI,KAAK,IAAKH,EAAM,KAAK,GAAK,GAAI,EACtCI,EAAID,EAAMD,EAEd,YAAK,IAAM,CACV,EAAID,EAAQ,EAAG,EAAG,EAClB,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAIE,EAAMD,GAASE,EAAG,GAC5B,EAAG,EAAG,EAAID,EAAMD,EAAO,GAAME,EAAG,CAAA,EAG1B,IAER,CAEO,OAAQC,EAAc3B,EAAiB4B,EAAc,CAE3D,MAAMC,EAAQF,EAAI,MAAA,EAAQ,IAAK3B,CAAO,EAAE,YAClC8B,EAAQF,EAAG,MAAA,EAAQ,MAAOC,CAAM,EAAE,YAClCE,EAAQF,EAAM,MAAA,EAAQ,MAAOC,CAAM,EAAE,YAE3C,YAAK,IAAM,CACRA,EAAM,EAAGC,EAAM,EAAGF,EAAM,EAAG,EAC3BC,EAAM,EAAGC,EAAM,EAAGF,EAAM,EAAG,EAC3BC,EAAM,EAAGC,EAAM,EAAGF,EAAM,EAAG,EAC3B,CAAEF,EAAI,IAAKG,CAAM,EACjB,CAAEH,EAAI,IAAKI,CAAM,EACjB,CAAEJ,EAAI,IAAKE,CAAM,EACjB,CAAA,EAGI,IAER,CAEO,SAAU,CAEhB,MAAMpB,EAAI,KAAK,IAAK,GAAKuB,EAAI,KAAK,IAAK,GAAKC,EAAI,KAAK,IAAK,GAAKP,EAAI,KAAK,IAAK,GAC5EQ,EAAI,KAAK,IAAK,GAAKC,EAAI,KAAK,IAAK,GAAKC,EAAI,KAAK,IAAK,GAAKC,EAAI,KAAK,IAAK,GACvExD,EAAI,KAAK,IAAK,GAAKyD,EAAI,KAAK,IAAK,GAAKC,EAAI,KAAK,IAAK,IAAMC,EAAI,KAAK,IAAK,IACxE,EAAI,KAAK,IAAK,IAAMC,EAAI,KAAK,IAAK,IAAMC,EAAI,KAAK,IAAK,IAAMC,EAAI,KAAK,IAAK,IAC1EC,EAAInC,EAAI0B,EAAIH,EAAIE,EAAGW,EAAIpC,EAAI2B,EAAIH,EAAIC,EACnCY,EAAIrC,EAAI4B,EAAIX,EAAIQ,EAAGa,EAAIf,EAAII,EAAIH,EAAIE,EACnCa,EAAIhB,EAAIK,EAAIX,EAAIS,EAAGvB,EAAIqB,EAAII,EAAIX,EAAIU,EACnCa,EAAIpE,EAAI4D,EAAIH,EAAI,EAAG/B,EAAI1B,EAAI6D,EAAIH,EAAI,EACnC/B,EAAI3B,EAAI8D,EAAIH,EAAI,EAAG7B,EAAI2B,EAAII,EAAIH,EAAIE,EACnCS,EAAIZ,EAAIK,EAAIH,EAAIC,EAAGU,EAAIZ,EAAII,EAAIH,EAAIE,EACnCU,EAAQR,EAAIO,EAAIN,EAAIK,EAAIJ,EAAInC,EAAIoC,EAAIvC,EAAIwC,EAAIzC,EAAIK,EAAIqC,EACpDI,EAAM,EAAID,EAEX,OAAKA,GAAO,EAAW,KAAK,YAE5B,KAAK,IAAK,IAAQjB,EAAIgB,EAAIf,EAAIc,EAAIb,EAAI1B,GAAM0C,EACvC,KAAA,IAAK,IAAQ,CAAErB,EAAImB,EAAIlB,EAAIiB,EAAIxB,EAAIf,GAAM0C,EAC9C,KAAK,IAAK,IAAQZ,EAAI7B,EAAI8B,EAAIM,EAAIL,EAAII,GAAMM,EACvC,KAAA,IAAK,IAAQ,CAAEf,EAAI1B,EAAI2B,EAAIS,EAAIR,EAAIO,GAAMM,EACzC,KAAA,IAAK,IAAQ,CAAEnB,EAAIiB,EAAIf,EAAI5B,EAAI6B,EAAI9B,GAAM8C,EAC9C,KAAK,IAAK,IAAQ5C,EAAI0C,EAAIlB,EAAIzB,EAAIkB,EAAInB,GAAM8C,EACvC,KAAA,IAAK,IAAQ,CAAE,EAAIzC,EAAI8B,EAAII,EAAIH,EAAIE,GAAMQ,EAC9C,KAAK,IAAK,IAAQxE,EAAI+B,EAAI2B,EAAIO,EAAIN,EAAIK,GAAMQ,EAC5C,KAAK,IAAK,IAAQnB,EAAIgB,EAAIf,EAAI3B,EAAI6B,EAAIY,GAAMI,EACvC,KAAA,IAAK,IAAQ,CAAE5C,EAAIyC,EAAIlB,EAAIxB,EAAIkB,EAAIuB,GAAMI,EAC9C,KAAK,IAAK,KAAS,EAAIL,EAAIP,EAAIK,EAAIH,EAAIC,GAAMS,EACxC,KAAA,IAAK,KAAS,CAAExE,EAAImE,EAAIV,EAAIQ,EAAIN,EAAII,GAAMS,EAC1C,KAAA,IAAK,KAAS,CAAEnB,EAAIvB,EAAIwB,EAAI5B,EAAI6B,EAAIa,GAAMI,EAC/C,KAAK,IAAK,KAAS5C,EAAIE,EAAIqB,EAAIzB,EAAI0B,EAAIgB,GAAMI,EACxC,KAAA,IAAK,KAAS,CAAE,EAAIN,EAAIN,EAAII,EAAIH,EAAIE,GAAMS,EAC/C,KAAK,IAAK,KAASxE,EAAIkE,EAAIT,EAAIO,EAAIN,EAAIK,GAAMS,EAEtC,KAER,CAEO,IAAKjC,EAAgB,OAE3B,QAAUvC,EAAI,EAAGA,EAAI,KAAK,IAAI,OAAQA,IAEhC,KAAA,IAAKA,IAAMyE,EAAAlC,EAAKvC,KAAL,KAAAyE,EAAY,EAItB,OAAA,IAER,CAEO,iBAAkBC,EAAWC,EAAWC,EAAc,CAE5D,YAAK,SAAS,EAEd,KAAK,cAAeF,CAAI,EAExB,KAAK,SAAUC,CAAI,EAEnB,KAAK,WAAYC,CAAM,EAEhB,IAER,CAEO,UAAWF,EAAYC,EAAYC,EAAe,CAEnDF,IAEAA,EAAA,EAAI,KAAK,IAAK,IACdA,EAAA,EAAI,KAAK,IAAK,IACdA,EAAA,EAAI,KAAK,IAAK,IAIpB,CAEO,cAAeG,EAAiB,CAEtC,YAAK,OAAQ,CACZ,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACTA,EAAS,EAAGA,EAAS,EAAGA,EAAS,EAAG,CAAA,CACnC,EAEK,IAER,CAEO,SAAUC,EAAiB,CAE7B,IAAA1B,EAAI,KAAK,IAAK0B,EAAS,CAAE,EAAG,EAAI,KAAK,IAAKA,EAAS,CAAE,EAEzD,YAAK,OAAQ,CACZ,EAAG,EAAG,EAAG,EACT,EAAG1B,EAAG,EAAG,EACT,EAAG,CAAE,EAAGA,EAAG,EACX,EAAG,EAAG,EAAG,CAAA,CACR,EAEEA,EAAA,KAAK,IAAK0B,EAAS,CAAE,EAAG,EAAI,KAAK,IAAKA,EAAS,CAAE,EAErD,KAAK,OAAQ,CACZ1B,EAAG,EAAG,CAAE,EAAG,EACX,EAAG,EAAG,EAAG,EACN,EAAG,EAAGA,EAAG,EACZ,EAAG,EAAG,EAAG,CAAA,CACR,EAEEA,EAAA,KAAK,IAAK0B,EAAS,CAAE,EAAG,EAAI,KAAK,IAAKA,EAAS,CAAE,EAErD,KAAK,OAAQ,CACZ1B,EAAG,EAAG,EAAG,EACT,CAAE,EAAGA,EAAG,EAAG,EACX,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,CAAA,CACR,EAEK,IAER,CAEO,WAAYwB,EAAc,CAEhC,YAAK,OAAQ,CACZA,EAAM,EAAG,EAAG,EAAG,EACf,EAAGA,EAAM,EAAG,EAAG,EACf,EAAG,EAAGA,EAAM,EAAG,EACf,EAAG,EAAG,EAAG,CAAA,CACR,EAEK,IAER,CAEU,OAAQG,EAAiB,CAE5B,MAAAC,EAAO,IAAI,MAAO,EAAG,EAE3B,QAAUhF,EAAI,EAAGA,EAAI,EAAGA,IAEvB,QAAUyD,EAAI,EAAGA,EAAI,EAAGA,IAAO,CAE9B,IAAIwB,EAAM,EAEV,QAAUvB,EAAI,EAAGA,EAAI,EAAGA,IAEvBuB,GAAO,KAAK,IAAKvB,EAAI,EAAID,GAAMsB,EAAMrB,EAAI1D,EAAI,GAIxCgF,EAAAvB,EAAIzD,EAAI,GAAMiF,CAErB,CAID,KAAK,IAAMD,CAEZ,CAEO,SAAUE,EAAa,CAExB,YAAA,OAAQA,EAAE,GAAI,EAEZ,IAER,CAEO,YAAaA,EAAa,CAEhC,MAAMC,EAAM,KAAK,YAAa,CAAG,CAAA,EAE5B,YAAA,IAAKD,EAAE,GAAI,EAEhB,KAAK,OAAQC,CAAI,EAEV,IAER,CAEO,YAAaC,EAAkB,CAE/BA,EAAA,OAAS,KAAK,IAAI,OAExB,QAAUpF,EAAI,EAAGA,EAAI,KAAK,IAAI,OAAQA,IAE9BoF,EAAApF,GAAM,KAAK,IAAKA,GAIjB,OAAAoF,CAER,CAGD,CC1RO,MAAMC,CAAS,CAMrB,aAAc,CAJd,KAAO,MAAgB,EAEvB,KAAO,WAAyC,EAGhD,CAEO,aAAc5F,EAA8C2F,EAAiBzF,EAAe,CAElG,KAAK,WAAYF,GAAS,CACzB,MAAA2F,EACA,KAAAzF,CAAA,EAGD,KAAK,gBAAgB,CAEtB,CAEO,aAAcF,EAA+C,CAEnE,OAAO,KAAK,WAAYA,EAEzB,CAEQ,iBAAkB,CAEzB,MAAM6F,EAAO,OAAO,KAAM,KAAK,UAAW,EAE1C,KAAK,MAAQA,EAAK,OAAS,EAAI,IAAW,EAE1CA,EAAK,QAAiB7F,GAAA,CAEf,MAAAQ,EAAY,KAAK,WAAYR,GAE9BA,GAAQ,UAEP,KAAA,MAAQ,KAAK,IAAKQ,EAAU,MAAM,OAASA,EAAU,KAAM,KAAK,KAAM,EAE5E,CAEC,CAEH,CAIO,mBAAoBsF,EAAY9F,EAA8C+F,EAA+DC,EAAyB,MAAyB,CAE/L,MAAA5F,EAAO,KAAK,aAAcJ,CAAK,EAE9B,MAAA,CACN,OAAQ8F,EAAK,aAAA,EAAe,QAAS,IAAIC,EAAa3F,EAAK,KAAM,EAAG4F,CAAW,EAC/E,KAAM5F,EAAK,KACX,MAAOA,EAAK,MAAM,OAASA,EAAK,IAAA,CAGlC,CAEO,aAAc0F,EAAa,CAE1B,MAAA,CACN,WAAY,CACX,CAAE,KAAM,WAAY,GAAG,KAAK,mBAAoBA,EAAM,WAAY,YAAa,CAAE,EACjF,CAAE,KAAM,KAAM,GAAG,KAAK,mBAAoBA,EAAM,KAAM,YAAa,CAAE,EACrE,CAAE,KAAM,SAAU,GAAG,KAAK,mBAAoBA,EAAM,SAAU,YAAa,CAAE,CAC9E,EACA,MAAO,KAAK,mBAAoBA,EAAM,QAAS,YAAa,KAAM,CAAA,CAGpE,CAED,CC7EO,MAAMG,UAAqBL,CAAS,CAE1C,YAAaM,EAAgB,EAAGC,EAAiB,EAAGC,EAAgB,EAAI,CAEjE,QAEN,MAAMC,EAAKH,EAAQ,EACbI,EAAKH,EAAS,EACdI,EAAKH,EAAQ,EAEbI,EAAW,CAChB,CAAEH,EAAIC,EAAIC,EACVF,EAAIC,EAAIC,EACR,CAAEF,EAAI,CAAEC,EAAIC,EACZF,EAAI,CAAEC,EAAIC,EAEVF,EAAIC,EAAI,CAAEC,EACV,CAAEF,EAAIC,EAAI,CAAEC,EACZF,EAAI,CAAEC,EAAI,CAAEC,EACZ,CAAEF,EAAI,CAAEC,EAAI,CAAEC,EAEdF,EAAIC,EAAIC,EACRF,EAAIC,EAAI,CAAEC,EACVF,EAAI,CAAEC,EAAIC,EACVF,EAAI,CAAEC,EAAI,CAAEC,EAEZ,CAAEF,EAAIC,EAAI,CAAEC,EACZ,CAAEF,EAAIC,EAAIC,EACV,CAAEF,EAAI,CAAEC,EAAI,CAAEC,EACd,CAAEF,EAAI,CAAEC,EAAIC,EAEZF,EAAIC,EAAI,CAAEC,EACVF,EAAIC,EAAIC,EACR,CAAEF,EAAIC,EAAI,CAAEC,EACZ,CAAEF,EAAIC,EAAIC,EAEV,CAAEF,EAAI,CAAEC,EAAI,CAAEC,EACd,CAAEF,EAAI,CAAEC,EAAIC,EACZF,EAAI,CAAEC,EAAI,CAAEC,EACZF,EAAI,CAAEC,EAAIC,CAAA,EAILE,EAAc,CACnB,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,GACN,EAAG,EAAG,GACN,EAAG,EAAG,GACN,EAAG,EAAG,GACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,GAAK,EAAG,EACR,GAAK,EAAG,EACR,GAAK,EAAG,EACR,GAAK,EAAG,EACR,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,EAAG,EACN,EAAG,GAAK,EACR,EAAG,GAAK,EACR,EAAG,GAAK,EACR,EAAG,GAAK,CAAA,EAGHC,EAAU,CAAA,EACVC,EAAa,CAAA,EAEnB,QAAUpG,EAAI,EAAGA,EAAI,EAAGA,IAAO,CAEtBmG,EAAA,KACP,EAAG,EACH,EAAG,EACH,EAAG,EACH,EAAG,CAAA,EAGJ,MAAME,EAAS,EAAIrG,EAERoG,EAAA,KACV,EAAIC,EAAQ,EAAIA,EAAQ,EAAIA,EAAQ,EAAIA,EAAQ,EAAIA,EAAQ,EAAIA,CAAA,CAGlE,CAEK,KAAA,aAAc,WAAYJ,EAAU,CAAE,EACtC,KAAA,aAAc,SAAUC,EAAa,CAAE,EACvC,KAAA,aAAc,KAAMC,EAAS,CAAE,EAC/B,KAAA,aAAc,QAASC,EAAY,CAAE,CAE3C,CAED,CChGO,MAAME,UAAyBjB,CAAS,CAE9C,YAAakB,EAAoB,GAAKC,EAAuB,GAAKZ,EAAiB,EAAGa,EAAsB,GAAIC,EAAyB,EAAI,CAEtI,QAEN,MAAMT,EAAW,CAAA,EACXC,EAAc,CAAA,EACdC,EAAU,CAAA,EACVC,EAAa,CAAA,EAGnB,QAAUpG,EAAI,EAAGA,GAAK0G,EAAiB,EAAG1G,IAEzC,QAAUyD,EAAI,EAAGA,EAAIgD,EAAahD,IAAO,CAExC,MAAMkD,EAAQ,KAAK,GAAK,EAAMF,EAAchD,EAE5C,GAAKzD,GAAK0G,EAAiB,CAG1B,MAAMtC,EAAIpE,EAAI0G,EACRE,GAAW,EAAMxC,GAAMoC,EAAepC,EAAImC,EAE1C7E,EAAI,KAAK,IAAKiF,CAAM,EAAIC,EACxBjF,EAAI,EAAIiE,EAAS,GAAQA,EAASc,EAAmB1G,EACrD8B,EAAI,KAAK,IAAK6E,CAAM,EAAIC,EAErBX,EAAA,KAAMvE,EAAGC,EAAGG,CAAE,EAEfqE,EAAA,KACP1C,EAAIgD,EACJzG,EAAI0G,CAAA,EAGL,MAAMG,EAAS,IAAIhF,EAAS,KAAK,IAAK8E,CAAM,EAAG,EAAG,KAAK,IAAKA,CAAM,CAAE,EAAE,UAAU,EAEpET,EAAA,KACXW,EAAO,EACPA,EAAO,EACPA,EAAO,CAAA,EAGH7G,EAAI0G,GAEGN,EAAA,KACVpG,EAAIyG,EAAchD,GAChBzD,EAAI,GAAMyG,GAAgBhD,EAAI,GAAMgD,EACtCzG,EAAIyG,GAAgBhD,EAAI,GAAMgD,EAE9BzG,EAAIyG,EAAchD,GAChBzD,EAAI,GAAMyG,EAAchD,GACxBzD,EAAI,GAAMyG,GAAgBhD,EAAI,GAAMgD,CAAA,CAIxC,KAEM,CAIA,MAAAK,EAAO9G,EAAI0G,EAAiB,EAE5BE,EAASE,EAAOP,EAAYC,EAE5B9E,EAAI,KAAK,IAAKiF,CAAM,EAAIC,EACxBjF,EAAI,EAAIiE,EAAS,GAAMA,EAAWkB,EAClChF,EAAI,KAAK,IAAK6E,CAAM,EAAIC,EAErBX,EAAA,KAAMvE,EAAGC,EAAGG,CAAE,EAEfqE,EAAA,MACLzE,EAAIkF,GAAW,GAAMA,GACrB9E,EAAI8E,GAAW,GAAMA,CAAA,EAGxBV,EAAY,KAAM,EAAG,GAAMY,EAAO,EAAG,CAAE,EAEjC,MAAAT,EAASI,GAAgBC,GAAmBI,EAAO,IAEpDrD,GAAKgD,EAAc,IAElBK,GAAQ,EAEDV,EAAA,KACVC,EAAQA,EAAS5C,EAAG4C,EAAS5C,EAAI,CAAA,EAKvB2C,EAAA,KACVC,EAAQA,EAAS5C,EAAI,EAAG4C,EAAS5C,CAAA,EAOrC,CAED,CAcI,KAAA,aAAc,WAAYwC,EAAU,CAAE,EACtC,KAAA,aAAc,SAAUC,EAAa,CAAE,EACvC,KAAA,aAAc,KAAMC,EAAS,CAAE,EAC/B,KAAA,aAAc,QAASC,EAAY,CAAE,CAE3C,CAED,CC3HO,MAAMW,UAAsB1B,CAAS,CAE3C,YAAaM,EAAgB,EAAGC,EAAiB,EAAGoB,EAAwB,EAAGN,EAAyB,EAAI,CAErG,QAEN,MAAMZ,EAAKH,EAAQ,EACbI,EAAKH,EAAS,EAEdK,EAAW,CAAA,EACXC,EAAc,CAAA,EACdC,EAAU,CAAA,EACVC,EAAa,CAAA,EAEnB,QAAUpG,EAAI,EAAGA,GAAK0G,EAAgB1G,IAErC,QAAUyD,EAAI,EAAGA,GAAKuD,EAAevD,IAAO,CAE3C,MAAM/B,EAAM+B,EAAIuD,EACVrF,EAAM3B,EAAIgH,EAYX,GAVIf,EAAA,KACR,CAAEH,EAAKH,EAAQjE,EACf,CAAEqE,EAAKH,EAASjE,EAChB,CAAA,EAGOwE,EAAA,KAAMzE,EAAGC,CAAE,EAEPuE,EAAA,KAAM,EAAG,EAAG,CAAE,EAErBlG,EAAI,GAAKyD,EAAI,EAAI,CAErB,MAAMG,EAAMoD,EAAgB,EACtBC,EAAKrD,EAAI5D,EAAIyD,EACbyD,EAAKtD,GAAM5D,EAAI,GAAMyD,EAAI,EAEpB2C,EAAA,KACVa,EAAIrD,EAAI5D,EAAIyD,EAAI,EAAGyD,EACnBD,EAAIC,EAAItD,GAAM5D,EAAI,GAAMyD,CAAA,CAG1B,CAED,CAII,KAAA,aAAc,WAAYwC,EAAU,CAAE,EACtC,KAAA,aAAc,SAAUC,EAAa,CAAE,EACvC,KAAA,aAAc,KAAMC,EAAS,CAAE,EAC/B,KAAA,aAAc,QAASC,EAAY,CAAE,CAE3C,CAED,CCtDO,MAAMe,UAAuB9B,CAAS,CAE5C,YAAauB,EAAiB,GAAKI,EAAwB,GAAIN,EAAyB,GAAK,CAEtF,QAEN,MAAMT,EAAW,CAAA,EACXC,EAAc,CAAA,EACdC,EAAU,CAAA,EACVC,EAAa,CAAA,EAEnB,QAAUpG,EAAI,EAAGA,GAAK0G,EAAgB1G,IAAO,CAEtC,MAAAoH,EAASpH,EAAI0G,EAAiB,KAAK,GAEnCW,GAAarH,GAAK,GAAKA,GAAK0G,EAAmBM,GAErD,QAAUvD,EAAI,EAAGA,EAAI4D,EAAU5D,IAAO,CAIrC,MAAM6D,EAAS7D,EAAI4D,EAAW,KAAK,GAAK,EAClCE,EAAc,KAAK,IAAKH,CAAO,EAAIR,EAEnClF,EAAI,KAAK,IAAK4F,CAAO,EAAIC,EACzB5F,EAAI,CAAE,KAAK,IAAKyF,CAAO,EAAIR,EAC3B9E,EAAI,KAAK,IAAKwF,CAAO,EAAIC,EAEtBtB,EAAA,KAAMvE,EAAGC,EAAGG,CAAE,EAIfqE,EAAA,KACP1C,EAAI4D,EACJrH,EAAI0G,CAAA,EAKL,MAAMG,EAAS,IAAIhF,EAASH,EAAGC,EAAGG,CAAE,EAAE,YAEtCoE,EAAY,KAAMW,EAAO,EAAGA,EAAO,EAAGA,EAAO,CAAE,EAIpCT,EAAA,KACVpG,EAAIgH,EAAgBvD,GAClBzD,EAAI,GAAMgH,GAAkBvD,EAAI,GAAMuD,EACxChH,EAAIgH,GAAkBvD,EAAI,GAAMuD,EAEhChH,EAAIgH,EAAgBvD,GAClBzD,EAAI,GAAMgH,EAAgBvD,GAC1BzD,EAAI,GAAMgH,GAAkBvD,EAAI,GAAMuD,CAAA,CAI1C,CAED,CAEK,KAAA,aAAc,WAAYf,EAAU,CAAE,EACtC,KAAA,aAAc,SAAUC,EAAa,CAAE,EACvC,KAAA,aAAc,KAAMC,EAAS,CAAE,EAC/B,KAAA,aAAc,QAASC,EAAY,CAAE,CAE3C,CAEO,aAAc3G,EAAoE2F,EAAiBzF,EAAqB,CAEzHF,GAAQ,SAEN2F,EAAA,QAAS,CAAEoC,EAAMC,IAAW,CAG1BrC,EAAAqC,GAAUD,EAAO,KAAK,KAAA,CAE5B,EAIG,MAAA,aAAc/H,EAAM2F,EAAOzF,CAAK,CAIvC,CAED,CC9EO,MAAM+H,CAAI,CAMhB,aAAc,CAEb,KAAK,KAAO,EACZ,KAAK,eAAiB,IAAI,KAAK,EAAE,QAAQ,CAE1C,CAEO,aAAqB,CAEpB,MAAA,CACN,mBAAoB,EACpB,SAAU,CAAC,EACX,eAAgB,IAChB,YAAa,GAAI,CAGnB,CAIO,aAAcC,EAAuB,CAE3C,MAAMC,EAAiBD,EAAM,qBAEvB,OAAAA,EAAA,SAAS,KAAMC,CAAO,EAErBA,CAER,CAEO,aAAcD,EAAcC,EAAuB,CAEzD,MAAMH,EAAQE,EAAM,SAAS,UAAWtE,GAAKA,GAAKuE,CAAO,EAEpDH,EAAQ,IAENE,EAAA,SAAS,MAAOF,EAAO,CAAE,CAIjC,CAIO,aAAoCE,EAAcC,EAAgBC,EAA8BC,EAAe,CAErH,IAAIC,EAAiBJ,EAAM,WAAW,IAAKE,CAAc,EAEpDE,IAAmB,SAEvBA,EAAiB,CAAA,EAEXJ,EAAA,WAAW,IAAKE,EAAeE,CAAe,GAIhDA,EAAe,OAASH,EAAS,IAErCG,EAAe,OAASH,EAAS,GAIlCG,EAAgBH,GAAWE,CAE5B,CAEO,gBAAiBH,EAAcC,EAAgBC,EAA+B,CAEpF,MAAME,EAAiBJ,EAAM,WAAW,IAAKE,CAAc,EAEtDE,GAAkBA,EAAe,OAASH,IAE9CG,EAAgBH,GAAW,KAI7B,CAEO,aAAoCD,EAAcC,EAAgBC,EAAyC,CAEjH,MAAMC,EAAYH,EAAM,WAAW,IAAKE,CAAc,EAEtD,OAAKC,IAAc,QAETA,EAAWF,IAAY,IAMlC,CAIO,UAA8BD,EAAcK,EAAoBC,EAAY,CAE5EN,EAAA,QAAQ,IAAKK,EAAYC,CAAO,CAEvC,CAEO,aAAcN,EAAcE,EAA+B,CAE3DF,EAAA,QAAQ,OAAQE,CAAc,CAErC,CAIO,OAAQF,EAAe,CAE7B,MAAMO,EAAM,IAAI,KAAK,EAAE,QAAQ,EACzBC,GAAcD,EAAM,KAAK,gBAAmB,IAClD,KAAK,MAAQC,EACb,KAAK,eAAiBD,EAEHP,EAAM,QAEd,QAAmBM,GAAA,CAE7BA,EAAO,OAAQ,CACd,MAAAN,EACA,UAAAQ,EACA,KAAM,KAAK,KACX,IAAK,IAAA,CACJ,CAAA,CAED,CAEH,CAIO,YAAaR,EAAcS,EAA+B,CAsBzD,OApBUT,EAAM,SAAS,OAAgBU,GAAA,CAE/C,QAAUrI,EAAI,EAAGA,EAAIoI,EAAM,OAAQpI,IAAO,CAEzC,MAAM6H,EAAgBO,EAAOpI,GAEvB8H,EAAYH,EAAM,WAAW,IAAKE,CAAc,EAEtD,GAAKC,IAAc,QAAaA,EAAWO,KAAW,OAE9C,MAAA,EAIT,CAEO,MAAA,EAAA,CAEN,CAIH,CAED,CCrKO,MAAMC,CAAO,CAInB,YAAaC,EAAuC,CAEnD,KAAK,QAAU,GAET,MAAAjD,EAAO,OAAO,KAAMiD,CAAQ,EAElC,QAAUvI,EAAI,EAAGA,EAAIsF,EAAK,OAAQtF,IAAO,CAExC,MAAMP,EAAO6F,EAAMtF,GAEnB,KAAK,QAAQ,KAAM,CAAE,KAAAP,EAAM,MAAO8I,EAAS9I,GAAS,CAErD,CAED,CAEO,OAAQ+I,EAAiC,CAE/C,QAAUxI,EAAI,EAAGA,EAAI,KAAK,QAAQ,OAAQA,IAAO,CAE1C,MAAA+D,EAAI,KAAK,QAAS/D,GAElByI,EAAWD,EAAM,IAAI,YAAaA,EAAM,MAAOzE,EAAE,KAAM,EAExD,KAAA,iBAAkBA,EAAE,KAAMyE,CAAM,EAErC,QAAU/E,EAAI,EAAGA,EAAIgF,EAAS,OAAQhF,IAErC,KAAK,WAAYM,EAAE,KAAM0E,EAAUhF,GAAK+E,CAAM,EAI1C,KAAA,gBAAiBzE,EAAE,KAAMyE,CAAM,CAErC,CAED,CAEU,iBAAkBE,EAAmBF,EAA2B,CAC1E,CAEU,WAAYE,EAAmBd,EAAgBY,EAA2B,CACpF,CAEU,gBAAiBE,EAAmBF,EAA2B,CACzE,CAED,CCxDO,MAAMG,CAAW,CAUvB,YAAaC,EAAUjB,EAAe,CAErC,KAAK,IAAMiB,EACX,KAAK,MAAQjB,EAEb,KAAK,SAAW,GAEhB,KAAK,0BAA4B,KACjC,KAAK,iBAAmB,IAEzB,CAEO,IAAKkB,EAAgBC,EAAgB,CAE3C,MAAMC,EAAa,KAAK,IAAI,aAAkC,KAAK,MAAOF,EAAQ,WAAY,EAE9F,GAAKE,IAAe,KAAO,CAE1B,QAAQ,IAAK,oBAAqB,EAElC,MAED,CAEA,MAAMC,EAAY,KAAK,IAAI,aAAkC,KAAK,MAAOF,EAAO,WAAY,EAE5F,GAAKE,IAAc,KAAO,CAEzB,QAAQ,IAAK,sBAAuB,EAEpC,MAED,CAEKA,EAAU,SAAW,QAEpB,KAAA,OAAQA,EAAU,OAAQF,CAAM,EAI3BC,EAAA,SAAS,KAAMD,CAAM,EAChCE,EAAU,OAASH,EAEnB,KAAK,SAAW,MAAM,KAAM,IAAI,IAAK,CAAEA,EAAQC,EAAO,GAAG,KAAK,QAAS,CAAE,CAAE,EAE3E,KAAK,0BAA4B,IAElC,CAEO,OAAQD,EAAgBC,EAAgB,CAE9C,MAAMC,EAAa,KAAK,IAAI,aAAkC,KAAK,MAAOF,EAAQ,WAAY,EAE9F,GAAKE,IAAe,KAAO,CAE1B,QAAQ,IAAK,oBAAqB,EAElC,MAED,CAEA,MAAMC,EAAY,KAAK,IAAI,aAAkC,KAAK,MAAOF,EAAO,WAAY,EAE5F,GAAKE,IAAc,KAAO,CAEzB,QAAQ,IAAK,sBAAuB,EAEpC,MAED,CAIA,IAAIhJ,EAAI+I,EAAW,SAAS,UAAWnB,GAAUA,GAAUkB,CAAM,EAE5D9I,EAAI,IAEG+I,EAAA,SAAS,OAAQ/I,EAAG,CAAE,EAIlCgJ,EAAU,OAAS,OAInBhJ,EAAI,KAAK,SAAS,UAAW4H,GAAUA,IAAWkB,CAAM,EAEnD9I,EAAI,IAEH,KAAA,SAAS,OAAQA,EAAG,CAAE,EAI5B,KAAK,0BAA4B,IAElC,CAEO,yBAA0B,CAEhC,GAAK,KAAK,0BAA4B,OAAO,KAAK,0BAElD,MAAMiJ,EAAwB,CAAA,EAExBC,EAAMtB,GAAoB,CAE/BqB,EAAY,KAAMrB,CAAO,EAEzB,MAAMuB,EAAY,KAAK,IAAI,aAAkC,KAAK,MAAOvB,EAAQ,WAAY,EAE7F,GAAKuB,EAEJ,QAAUnJ,EAAI,EAAGA,EAAImJ,EAAU,SAAS,OAAQnJ,IAE5CkJ,EAAAC,EAAU,SAAUnJ,EAAI,CAI7B,EAID,QAAUA,EAAI,EAAGA,EAAI,KAAK,SAAS,OAAQA,IAAO,CAE3C,MAAA4H,EAAS,KAAK,SAAU5H,GAExBmJ,EAAY,KAAK,IAAI,aAAkC,KAAK,MAAOvB,EAAQ,WAAY,EAExFuB,GAAaA,EAAU,SAAW,QAEtCD,EAAGtB,CAAO,CAKZ,CAEA,YAAK,0BAA4BqB,EAE1BA,CAER,CAGD"}