# GLPower テスト実装方針

## 1. プロジェクト構造とテスト環境の現状

### テストフレームワーク

- Jest + jsdom によるユニットテスト
- Jest + Puppeteer による e2e テスト
- カバレッジ要件: 80%以上のライン カバレッジ

### 既存のテスト

- ユニットテスト: Math/Vector.test.ts のみ
- E2E テスト: Docs.test.ts のみ

## 2. テストが必要な主要コンポーネント

### A. コア WebGL クラス群

- GLPowerBuffer
- GLPowerFrameBuffer
- GLPowerProgram
- GLPowerTexture
- GLPowerVAO
- Power (メインクラス)

### B. 数学ユーティリティ

- Vector (テスト済み)
- Matrix
- Quaternion
- Euler

### C. アニメーション関連

- Animator
- FCurve
- FCurveGroup
- Bezier
- Easings

### D. ユーティリティ

- EventEmitter
- ID

## 3. テスト方針

### ユニットテスト優先順位

1. 数学ユーティリティ (Math/) - 基礎となる計算ロジック
   - 理由: 他の機能の基盤となる部分であり、純粋な関数として扱いやすい
2. アニメーション (Animation/) - 独立して動作する機能
   - 理由: 数学ユーティリティに依存するが、WebGL 部分から独立している
3. ユーティリティ (utils/) - 共通機能
   - 理由: 独立した機能として扱いやすい
4. WebGL コアクラス - モック化してテスト可能な部分
   - 理由: WebGL context に依存する部分が多いため、モック化が必要

### E2E テスト優先順位

1. examples/の各サンプルの動作確認
   - 目的: 実際のユースケースでの動作確認
   - 方法: Puppeteer によるブラウザテスト
2. WebGL コアクラスの実際のレンダリング結果
   - 目的: 視覚的な出力の確認
   - 方法: スクリーンショットの比較
3. アニメーションの視覚的な確認
   - 目的: アニメーションの滑らかさや正確性の確認
   - 方法: 時系列でのスクリーンショット比較

## 4. テスト実装方針

### ユニットテスト

- Vector.test.ts をテンプレートとして活用
- describe/it 形式でテストケースを整理
- beforeEach でテストデータを初期化
- 期待値と実際の値を比較
- テストケースの命名規則: "should ..." の形式で期待される動作を記述

### E2E テスト

- Puppeteer を使用してブラウザ環境でテスト
- スクリーンショットによる視覚的な検証
- パフォーマンス指標の計測
- テストケースの分類:
  - 機能テスト: 特定の機能が正しく動作するか
  - ビジュアルテスト: 描画結果が期待通りか
  - パフォーマンステスト: 処理速度や負荷が許容範囲内か

## 5. 次のステップ

### フェーズ 1: 基盤テストの実装

1. Math/ディレクトリの残りのクラスのテスト実装
   - Matrix.test.ts
   - Quaternion.test.ts
   - Euler.test.ts

### フェーズ 2: アニメーション機能のテスト

1. Animation/ディレクトリのテスト実装
   - FCurve.test.ts
   - FCurveGroup.test.ts
   - Bezier.test.ts
   - Easings.test.ts

### フェーズ 3: ユーティリティのテスト

1. utils/ディレクトリのテスト実装
   - EventEmitter.test.ts
   - ID.test.ts

### フェーズ 4: WebGL コアのテスト

1. WebGL コアクラスのユニットテスト実装
   - モック化戦略の検討
   - 各クラスのテスト実装

### フェーズ 5: E2E テストの拡充

1. 各 example に対する E2E テストの実装
2. パフォーマンステストの実装
3. ビジュアルリグレッションテストの実装

## 6. 注意点とベストプラクティス

### テストコード品質

- DRY 原則の遵守
- テストケースの独立性確保
- 適切なモック化とスタブ化
- 意図が明確なアサーション

### メンテナンス性

- テストコードの整理と文書化
- 共通ユーティリティの抽出
- テストデータの集中管理

### CI/CD 統合

- プルリクエスト時の自動テスト実行
- カバレッジレポートの自動生成
- テスト結果の可視化
